var _greepf_running=_greepf_running||!1;if(_greepf_running)throw new Error("gree is already running");_greepf_running=!0,function(){function a(a){for(var b,c="",e=-6,f=0,g=0,h=0;g<a.length||e>-6;)0>e&&(g<a.length?(b=a.charCodeAt(g++),h+=8):b=0,f=(255&f)<<8|255&b,e+=8),c+=d.charAt(h>0?f>>e&63:64),e-=6,h-=6;return c}function b(a){this.storage=a,this.subData={},this.suffix="";try{this.storage.setItem(j.prefix+j.ENABLE_FLAG,1),this.available=!0}catch(b){this.available=!1}}function c(a){this.nodeList=a,this.firstChild=a[0],this.name="GreeNodeList"}var d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";"undefined"==typeof document||"classList"in document.createElement("a")||!function(a){"use strict";if("HTMLElement"in a||"Element"in a){var b="classList",c="prototype",d=(a.HTMLElement||a.Element)[c],e=Object,f=String[c].trim||function(){return this.replace(/^\s+|\s+$/g,"")},g=Array[c].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1},h=function(a,b){this.name=a,this.code=DOMException[a],this.message=b},i=function(a,b){if(""===b)throw new h("SYNTAX_ERR","An invalid or illegal string was specified");if(/\s/.test(b))throw new h("INVALID_CHARACTER_ERR","String contains an invalid character");return g.call(a,b)},j=function(a){for(var b=f.call(a.className),c=b?b.split(/\s+/):[],d=0,e=c.length;e>d;d++)this.push(c[d]);this._updateClassName=function(){a.className=this.toString()}},k=j[c]=[],l=function(){return new j(this)};if(h[c]=Error[c],k.item=function(a){return this[a]||null},k.contains=function(a){return a+="",-1!==i(this,a)},k.add=function(){var a,b=arguments,c=0,d=b.length,e=!1;do a=b[c]+"",-1===i(this,a)&&(this.push(a),e=!0);while(++c<d);e&&this._updateClassName()},k.remove=function(){var a,b=arguments,c=0,d=b.length,e=!1;do{a=b[c]+"";var f=i(this,a);-1!==f&&(this.splice(f,1),e=!0)}while(++c<d);e&&this._updateClassName()},k.toggle=function(a,b){a+="";var c=this.contains(a),d=c?b!==!0&&"remove":b!==!1&&"add";return d&&this[d](a),c},k.toString=function(){return this.join(" ")},e.defineProperty){var m={get:l,enumerable:!0,configurable:!0};try{e.defineProperty(d,b,m)}catch(n){-2146823252===n.number&&(m.enumerable=!1,e.defineProperty(d,b,m))}}else e[c].__defineGetter__&&d.__defineGetter__(b,l)}}(self);var e={};e._user_agent=window.navigator.userAgent.toLowerCase(),e.ios=function(){return e.iphone()||e.ipod()||e.ipad()},e.iphone=function(){return e._find("iphone")},e.ipod=function(){return e._find("ipod")},e.ipad=function(){return e._find("ipad")},e.android=function(){return e._find("android")},e.androidPhone=function(){return e.android()&&e._find("mobile")},e.androidTablet=function(){return e.android()&&!e._find("mobile")},e.androidIcs=function(){return RegExp("Android 4.").test(navigator.userAgent)},e.mobile=function(){return e.androidPhone()||e.iphone()||e.ipod()},e.tablet=function(){return e.ipad()||e.androidTablet()},e.desktop=function(){return!e.tablet()&&!e.mobile()},e.webview=function(){var a=document.cookie.split(/;\s*/).reduce(function(a,b){var c=b.split(/=/);return a[c[0]]=c[1],a},{});return a.URLScheme?!0:!1},e.sdk=function(){var a=document.cookie.match(/(ios|android)SDKVersion=(.+?);/);return a?{device:a[1],version:a[2]}:null},e.isModernChrome=function(){var a=e._user_agent.toLowerCase();if(a.match(/android/i)){var b=a.match(/chrome\/([0-9]*)[.0-9]* ( Mobile)?/),c=1,d=25;return b&&b.length>=2&&b[c]>=d}},e._find=function(a){return-1!==e._user_agent.indexOf(a)};var f={};f.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)},f.isObject=function(a){return"[object Object]"===Object.prototype.toString.call(a)},f.isUndefined=function(a){return"undefined"==typeof a},f.isFunction=function(a){return a&&"function"==typeof a},f.copy=function(a){return f.isObject(a)?JSON.parse(JSON.stringify(a)):null},f.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)},f.startsWith=function(a,b){return 0===a.indexOf(b)},f.isEmpty=function(a){return f.isString(a)&&(a=a.trim()),null===a||""===a||f.isUndefined(a)||a.hasOwnProperty("length")&&0===a.length||f.isObject(a)&&0===Object.keys(a).length},f.appendSuffix=function(a,b){return b?a+"_"+b:a},f.match=function(a,b){if(a&&f.isArray(a)){var c,d;for(c=0;c<a.length;c++)if(d=a[c],new RegExp(d).test(b))return!0}return!1},f.isNumber=function(a){return"number"!=typeof a&&"string"!=typeof a?!1:a==parseFloat(a)&&isFinite(a)},f.setLocationHref=function(a,b,c){f.enabledDEBUG&&f.debug({type:"[important]",command:"Common.setLocationHref",href:a}),c=c||document,b?c.location.replace(a):c.location.href=a},f.getTime=Date.now||function(){return(new Date).getTime()},f._requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)},f.requestAnimationFrame=function(a){f._requestAnimationFrame.call(window,a)},f.createClickOnceHandler=function(a){return function(a){var b=!1,c={listener:function(d){b?f.isUndefined(d)?event.returnValue=!1:d.preventDefault():(b=!0,a(d,c))},reset:function(){b=!1},isExecuting:function(){return b}};return c}(a)},f.getUrlSeparator=function(a){return a.indexOf("?")>-1?"&":"?"},f.convertUrlParams=function(a,b){f.isUndefined(b)&&(b=!0);var c=[];for(var d in a)c.push(d+"="+encodeURIComponent(a[d]));return b&&c.push(".r="+parseInt(1e4*Math.random())),c.join("&")},f.appendUrlParmas=function(a,b,c){var d=f.getUrlSeparator(a),e=f.convertUrlParams(b,c);return a+d+e},f.htmlentities=function(a){return a.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},f.extend=function(a,b){for(var c in b)a[c]=b[c]},f.Queue=function(a,b){var c=[],d=5,e=5e3,g=function(){for(var a=f.getTime(),b=0;b<c.length;b++)c[b].time+e<a&&(c.splice(b,1),b--)};return a&&(e=a),b&&(d=b),{clear:function(){c=[]},length:function(){return c.length},enqueue:function(a){g(),c.length<d&&c.push({time:f.getTime(),data:a})},dequeue:function(){return g(),c.length>0?c.shift().data:null}}},f.createExecuteOnceHandler=function(a){return function(a){var b=!1,c={execute:function(c,d){b||(b=!0,d=d||{},a(c,d))},reset:function(){b=!1},isExecuting:function(){return b}};return c}(a)},f.contains=function(a,b){return a.indexOf(b)>=0},f.loop=function(a,b){"use strict";if(void 0===a||null===a)throw new TypeError;var c=Object(a),d=c.length>>>0;if("function"!=typeof b)throw new TypeError;for(var e=arguments.length>=3?arguments[2]:void 0,f=0;d>f;f++)if(f in c&&!1===b.call(e,c[f],f,c))return!1;return!0},f.debugType="console",window.changeGreeDebugType=function(a){f.enabledDEBUG=!0,f.enabledWARN=!0,f.enabledERROR=!0,f.debugType=a},f.enabledDEBUG=!1,f.enabledWARN=!0,f.enabledERROR=!0,f._log=function(a,b,c){if(f.isFunction(b)&&(b=b()),b=f.isObject(b)?JSON.stringify({type:a,msg:b}):"["+a+"]"+b,"alert"==f.debugType)alert(b);else{if(c){var d=new Error("Trace:");d.stack&&(b+="\n"+d.stack.replace("Error:",""))}console[a](b+"\n")}},f.debug=function(a,b){f.enabledDEBUG&&f._log("log",a,0!=b)},f.warn=function(a){f.enabledWARN&&f._log("warn",a)},f.error=function(a){f.enabledERROR&&f._log("error",a)};var g=function(a){this.name="GreeError",this.message=a,f.error(a)};g.prototype=new Error,g.prototype.constructor=g;var h=function(){function a(a){return 10>a?"0"+a:a}function b(a){var d,e,f,g,h,i=/["\\\x00-\x1f\x7f-\x9f]/g;switch(typeof a){case"string":return i.test(a)?'"'+a.replace(i,function(a){var b=c[a];return b?b:(b=a.charCodeAt(),"\\u00"+Math.floor(b/16).toString(16)+(b%16).toString(16))})+'"':'"'+a+'"';case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"undefined":return String(null);case"object":if(!a)return"null";if(d=[],"number"==typeof a.length&&!a.propertyIsEnumerable("length")){for(g=a.length,e=0;g>e;e+=1)d.push(b(a[e])||"null");return"["+d.join(",")+"]"}for(f in a)f.match("___$")||a.hasOwnProperty(f)&&"string"==typeof f&&(h=b(a[f]),h&&d.push(b(f)+":"+h));return"{"+d.join(",")+"}"}return"undefined"}Date.prototype.toJSON=function(){return[this.getUTCFullYear(),"-",a(this.getUTCMonth()+1),"-",a(this.getUTCDate()),"T",a(this.getUTCHours()),":",a(this.getUTCMinutes()),":",a(this.getUTCSeconds()),"Z"].join("")};var c={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return{stringify:b,parse:function(a){if(!a)return a;if(/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/b-u]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))try{return JSON.parse(a)}catch(b){return!1}return!1}}}(),j={prefix:"_greepf.",ENABLE_FLAG:"enable",APP:{CONFIG:"config",ANALYTICS:"analytics",HEARTBEAT_TIME:"heartbreat_time",THUMBNAIL:"thumb"},API:{CACHE:"api.cache"}};b.prototype.isAvailable=function(){return this.available},b.prototype.setSuffix=function(a){this.suffix=a},b.prototype.convertKey=function(a){return j.prefix+a+this.suffix},b.prototype.get=function(a,b){if(b||(a=this.convertKey(a)),!a)return null;if(this.subData[a])return this.subData[a];var c=this.storage.getItem(a);return c&&c.length>102400?(this.storage.removeItem(a),null):this.available?h.parse(c):null},b.prototype.set=function(a,b,c){return c||(a=this.convertKey(a)),this.available&&this.storage.setItem(a,h.stringify(b)),this.subData[a]=b,!0},b.prototype.remove=function(a,b){b||(a=this.convertKey(a)),this.available&&this.storage.removeItem(a),delete this.subData[a]},b.prototype.clear=function(){this.available&&this.storage.clear(),this.subData={}};var k,l;try{k=new b(localStorage)}catch(m){k=new b(sessionStorage)}l=new b(sessionStorage);var o={regex:{numeric:/^[0-9]+$/,notHtml:/^(?!.*<[^>]*>)/},required:function(a){return!f.isEmpty(a)},numeric:function(a){return o.regex.numeric.test(a)},array:function(a){return f.isArray(a)},object:function(a){return f.isObject(a)},string:function(a){return f.isString(a)},notHtml:function(a){return o.regex.notHtml.test(a)}},p={};p.constant={app_type:{PC:"pc",SMARTPHONE:"sp"},ready_state:{UNINITIALIZED:0,LOADING:1,LOADED:2,COMPLETE:3},start_type:{LOAD:"load",DOM_CONTENT_LOADED:"DOMContentLoaded",IMMEDIATELY:"immediately"},page_load_type:{MANUAL:"manual",HASHCHANGE:"hashchange"},COMMON_DIALOG_HEIGHT:44,FINGERPRINT:"1465181416095"},p.config={env:"",app_type:null,domain:"pf.gree.net",aimg_domain:"aimg-pf.gree.net",app_id:null,app_name:null,user_id:null,user_name:null,app_container_id:"gree-app-container",gree_container_id:"gree-pf-container",page_load_type:p.constant.page_load_type.MANUAL,start_type:p.constant.start_type.LOAD,enable_footer:!0,use_iframe:0,is_webview:void 0,app_top_url:null,session_utime:null,friends_count:null,develop_domain_list:[/^pf-dev-[a-z0-9_\-\.]+\.dev\.gree-dev\.net/,/^mpf-dev-[a-z0-9_\-\.]+\.dev\.gree\.jp/,"mpf-stg7.gree.jp","pf-stg7.gree.net","ppf-stg7.gree.net","pf-stg1-qa-pf.gree.jp","pf-stg1-qa-pf.gree.net"],css_dynamically_load:!0,js_ver:"current"},p.state={current_app_url:null,ready:p.constant.ready_state.UNINITIALIZED},p.module_config=null,p.modules={},p.init=function(){var a=document.location.hostname;for(var b in p.config.develop_domain_list)if(a.match(p.config.develop_domain_list[b])){f.enabledDEBUG=!0;break}}(),p.setAppConfig=function(a){Object.keys(a).forEach(function(b){f.isString(b)&&!f.isUndefined(a[b])&&("domain"===b&&p.config[b]!=a[b]?(p.config[b]=a[b],p._setDevelopEnv(a)):p.config[b]=a[b],"msg"===b&&p.dispatchEvent("message_loaded"))})},p._setDevelopEnv=function(a){p.config.env="dev",p.config.aimg_domain=a.js_hostname||a.domain},p._addStorageConfigData=function(){var a=k.get(j.APP.CONFIG);a&&p.setAppConfig(a)},p.updateStorageConfigData=function(a){var b=k.get(j.APP.CONFIG);b||(b={}),Object.keys(a).forEach(function(c){b[c]=a[c]}),k.set(j.APP.CONFIG,b),p.setAppConfig(a)},p.setMoudleConfig=function(a){p.module_config=a},p.addModule=function(a,b){p.modules[a]=b},p.getModule=function(a){return p.modules[a]},p._hasInitFunction=function(a){return a&&f.isFunction(a.init)},p._initModules=function(){Object.keys(p.modules).forEach(function(a){if(p._hasInitFunction(p.modules[a])){var b=p.module_config[a]||{};p.modules[a].init.call(p.modules[a],b)}})},p._start=function(a){p._initModules(),f.isFunction(a)&&a(),p.changeReadyState(p.constant.ready_state.LOADED),p.dispatchEvent("app_started")},p.start=function(a){if(p.changeReadyState(p.constant.ready_state.LOADING),p._addStorageConfigData(),p.constant.start_type.IMMEDIATELY!==p.config.start_type&&p.config.start_type){var b=!1;window.addEventListener(p.constant.start_type.DOM_CONTENT_LOADED,function c(){window.removeEventListener(p.constant.start_type.DOM_CONTENT_LOADED,c,!1);var d=!1,f=!1,g=p.getModule("replace_tag");g&&g.init&&(g.init(p.module_config.replace_tag),g.init=null,d=g.searchTag());var h=p.getModule("replace_tag_ics");h&&h.init&&p.config.use_iframe&&e.androidIcs()&&(h.init(p.module_config.replace_tag_ics),h.init=null,f=h.searchTag()),b=d||f,b&&p._start(a)}),window.addEventListener(p.config.start_type,function d(){window.removeEventListener(p.config.start_type,d,!1),b||p._start(a)},!1)}else p._start(a)},p.delay={},p.delay.queue=new f.Queue,p.delay.execute=function(){for(var a;a=p.delay.queue.dequeue();)a.func.apply(null,a.args);p.delay.queue.clear()},p.delay.command=function(a){return function(){return p.state.ready!=p.constant.ready_state.COMPLETE?void p.delay.queue.enqueue({func:a,args:arguments}):void a.apply(null,arguments)}},p.changeReadyState=function(a){p.state.ready!=p.constant.ready_state.COMPLETE&&(p.state.ready=a)},p.appendFingerprint=function(a){if(!a)return a;var b=f.getUrlSeparator(a);return a+b+p.constant.FINGERPRINT},p.getHttpRoot=function(){return p.config.domain?"http://"+p.config.domain+"/":null},p.getHttpAimgUrl=function(a){if(p.config.aimg_domain){var b="http://"+p.config.aimg_domain+"/"+a;return p.appendFingerprint(b)}return null},p.getGreeAppTopUrl=function(){return p.getHttpRoot()+p.config.app_id},p.getAppTopUrl=function(){return p.config.app_top_url?p.config.app_top_url:p.getHttpRoot()+p.config.app_id},p.getCurrentAppPageUrl=function(){return p.state.current_app_url?p.state.current_app_url:null},p.setCurrentAppPageUrl=function(a){a&&(p.state.current_app_url=a)},p.dispatchEvent=function(a){var b=p.getModule("event_manager");if(b&&f.isFunction(b.dispatchEvent)){var c=Array.prototype.slice.call(arguments);b.dispatchEvent.apply(null,c)}},p.getAppContainer=function(){var a=q("#"+p.config.app_container_id);if(!a.isNotEmpty()){var b=q("#gree‒app‒container");if(b.isNotEmpty())return p.config.app_container_id="gree‒app‒container",b}return a},c.prototype.show=function(){this.firstChild.style.display=""},c.prototype.isVisible=function(){return""===this.firstChild.style.display},c.prototype.hide=function(){this.firstChild.style.display="none"},c.prototype.html=function(a){return f.isUndefined(a)||(this.firstChild.innerHTML=a),this.firstChild.innerHTML},c.prototype.text=function(a){return f.isUndefined(a)||(this.firstChild.textContent=a),this.firstChild.textContent},c.prototype.append=function(a){return"GreeNodeList"===a.name&&(a=a.firstChild),this.firstChild.appendChild(a)},c.prototype.find=function(a,b){return this.firstChild?b&&this.firstChild.classList.contains(a.substring(1))?this:new c(this.firstChild.querySelectorAll(a)):void 0},c.prototype.addClass=function(a){this.firstChild.classList.add(a)},c.prototype.removeClass=function(a){this.firstChild.classList.remove(a)},c.prototype.toggleClass=function(a){this.firstChild&&this.firstChild.classList.toggle(a)},c.prototype.containsClass=function(a){return this.firstChild?this.firstChild.classList.contains(a):!1},c.prototype.bindEvent=function(a,b,c){if(this.firstChild){this.unbindEvent(a,b,c);var d=this;setTimeout(function(){d.firstChild.addEventListener(a,b,c)},1)}},c.prototype.unbindEvent=function(a,b,c){this.firstChild.removeEventListener(a,b,c)},c.prototype.selectChild=function(a,b){var d,e,f,g;for(d=[],e=this.firstChild.children,f=0;f<e.length;f++)e[f].hasAttribute(a)&&(g=e[f].getAttribute(a),g===b&&d.push(e[f]));return new c(d)},c.prototype.checked=function(a){return this.firstChild?(a&&(this.firstChild.checked=a),this.firstChild.checked):void 0},c.prototype.each=function(a){var b,d=!0;for(b=0;b<this.nodeList.length;b++){var e=arguments.length>=2?arguments[1]:void 0;if(d=a.call(e,new c([this.nodeList[b]]),b,this.nodeList),d===!1)break}},c.prototype.isNotEmpty=function(){return this.nodeList.length>0},c.prototype.isEmpty=function(){return 0===this.nodeList.length},c.prototype.contentWin=function(){return this.firstChild.contentWindow?this.firstChild.contentWindow:null},c.prototype.height=function(a){return f.isUndefined(a)||(f.isNumber(a)?this.firstChild.style.height=a+"px":this.firstChild.style.height=a),this.firstChild===window?this.firstChild.innerHeight:parseInt(this.getCurrentStyle().height)},c.prototype.getCurrentStyle=function(){return this.firstChild?this.firstChild.currentStyle||document.defaultView.getComputedStyle(this.firstChild,""):null},c.prototype.parentsAndSelfStyle=function(a,b){var c=this.firstChild;do"style"in c&&(c.style[a]=b);while(c=c.parentElement)},c.prototype.style=function(a,b){this.firstChild.style[a]=b},c.prototype.setAttribute=function(a,b){this.firstChild.setAttribute(a,b)},c.prototype.getAttribute=function(a){return this.firstChild.getAttribute(a)},c.prototype.remove=function(){this.firstChild&&this.firstChild.parentNode.removeChild(this.firstChild)},c.prototype.length=function(){return this.firstChild?this.nodeList.length:0},c.prototype.click=function(){this.firstChild.click()};var q=function(a){var b,d;return b=a===window?[window]:(d=a.match(/<([a-z]*)>/))?[document.createElement(d[1])]:document.querySelectorAll(a),new c(b)},f=f||{};f.util={},f.util.config={},f.util.filterAppUrlParams=function(a){var b=document.createElement("a");if(b.href=a,b.search){var c=["opensocial_app_id","opensocial_viewer_id","opensocial_owner_id","oauth_signature","oauth_signature_method","oauth_consumer_key","oauth_token","oauth_token_secret","oauth_nonce","oauth_timestamp","oauth_version"],d=b.search.replace(/^\?/,"").split("&"),e=[];f.loop(d,function(a){if(n=a.indexOf("=")){var b=a.substring(0,n);f.contains(c,b)||e.push(a)}}),a=b.hash?a.replace(/\?.+#/,"?"+e.join("&")+"#"):a.replace(/\?.+$/,"?"+e.join("&"))}return a},f.util.changePage=function(a){var b=p.getModule("game_container");b&&f.isFunction(b.changeUrl)?b.changeUrl(a):f.setLocationHref(a)},f.util.isGreeDomain=function(a){var b=p.config.domain.match(/[^\.]+\.[^\.]+$/);if(b){var c=new RegExp("."+b[0]+"$"),d=new RegExp("^"+b[0]+"$"),e=document.createElement("a");return e.href=a,e.host.match(c)||e.host.match(d)}return!1},f.util.requestLocation=function(a,b){if(!b){var c=function(a){var b=document.createElement("a");return b.href=decodeURIComponent(a),f.util.isGreeDomain(a)&&!f.contains(["gundam.gree.jp"],b.href)};if(c(a))return void f.setLocationHref(a)}if(0===a.indexOf(p.getHttpRoot()+p.config.app_id))return void f.setLocationHref(a);if(a.match("oauth_version="))return void f.util.changePage(a);var d=p.getModule("server_api");d.process("sdk_callbackurl",{app_id:p.config.app_id,url:a,sign:f.util.getSign(),app_type:p.config.app_type},function(b){b.callbackurl?f.util.changePage(b.callbackurl):f.error("Cross domain security error! Please refer to the allow_domains of gadget.xml. url:["+a+"]")})},f.util.ahref=function(a){var b=document.createEvent("MouseEvents");b.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null);var c=q("<a>");c.firstChild.href=a,p.getModule("container_manager").getContainer().append(c.firstChild),c.firstChild.dispatchEvent(b),c.remove()},f.util.launchNativeApp=function(a){var b=a.URL;if(!b||!f.contains(b,"greeapp"))return void p.dispatchEvent("launch_native_app_error",{code:400,msg:"error: Invalid App URL"});if(f.contains(b,"start"));else if(/\((iPhone( Simulator)?|iPod( touch)?|iPad);/.test(navigator.userAgent)){if(!a.ios_src||""==a.ios_src)return void p.dispatchEvent("launch_native_app_error",{code:401,msg:"error: Invalid iOS URL"});b=a.ios_src}else if(/Android/.test(navigator.userAgent)){if(!a.android_src||""==a.android_src)return void p.dispatchEvent("launch_native_app_error",{code:402,msg:"error: Invalid Android URL"});b=a.android_src}f.util.ahref(b)},f.util.isAndroidChrome=function(){var a=navigator.userAgent;return a.match(/Android/i)&&a.match(/Chrome\/[.0-9]* ( Mobile)?/)},f.util.isUsableAndroidIntent=function(){var a=navigator.userAgent;if(a.match(/Android/i)){var b=a.match(/Chrome\/([0-9]*)[.0-9]* ( Mobile)?/),c=1,d=25;return b&&b.length>=2&&b[c]>=d}return!1},f.util.launchExternalAppByAndroidIntent=function(a,b,c){var d="intent:{url}#Intent;package={package};scheme={scheme};end;";d=d.replace("{url}",a).replace("{package}",b).replace("{scheme}",c),f.setLocationHref(d)},f.util.launchExternalApp=function(a,b){var c="greepf-check-app-install";if(!document.getElementById(c)){var d=f.util.createEmptyIframe(c);d.height(0);var g=p.getModule("container_manager");g.getContainer().append(d.firstChild)}var h=function(a){f.isFunction(a)&&a()},i=document.getElementById(c);e.ios()?document.location=a+"&"+f.getTime():i.src=a+"&"+f.getTime();var j=f.getTime();setTimeout(function(){var c=f.getTime();if(400>c-j)try{var d=i.contentWindow.document.body.innerHTML;null==d||""==d?h(b):f.setLocationHref(a)}catch(e){h(b)}},300)},f.util.launchedExternalApp=function(){var a=null,b=function(){var c=f.getTime(),d=c>a+2e3;d?a=null:setTimeout(b,100)};return{launched:function(){a=f.getTime(),b()},isLaunched:function(){return null!=a}}}(),f.util.getApi=function(a){var b,c=[p.getModule("server_api"),p.getModule("client_ui"),p.getModule("client_api")];return f.loop(c,function(c){return c&&c.get(a)?(b=c,!1):void 0}),b||f.warn("unkown api ["+a+"]"),b},f.util.isWebview=function(){var a=p.getModule("webview");return a&&a.isWebview()},f.util.createEmptyIframe=function(a,b){var c=q("<iframe>"),d=c.firstChild;return a&&(d.id=a),b&&(d.name=b),d.src="about:blank",d.style.border="0px",d.style.margin="0px",d.style.padding="0px",d.style.display="block",d.style.width=(window.innerWidth>0?window.innerWidth:screen.width)+"px",c},f.util.adjustIframeHeight=function(a){var b=window.innerHeight-p.constant.COMMON_DIALOG_HEIGHT;if(!a.getAttribute("src")||"about:blank"==a.getAttribute("src")){var c=a.contentWin().document.body;b=Math.max(b,c.offsetHeight,c.scrollHeight)}a.height(b)},f.util.getCommonHeaderHtml=function(a,b,c){b=b||"",c=c||"greepf-common-";var d=String()+" <div id='header-back' class='greepf-common-dialog-header-back' style='display:none'> <div class='greepf-common-dialog-header-back-button'></div> </div> <div id='header-title' class='greepf-common-dialog-header-title'>"+b+"</div> <div id='header-close' class='greepf-common-dialog-header-close'> <div class='greepf-common-dialog-header-close-button'></div> </div>";return a&&(d=" <div id='header' class='greepf-common-dialog-header'>"+d+" </div>"),d.replace(/id='/g,"id='"+c)},f.util.replaceIframeHtml=function(a,b){var c=a.contentWin().document;c.open("text/htmlreplace"),c.write(b),c.close()},f.util.prepareOpenDialog=function(a){var b=a.prefix,c=f.util.getCommonHeaderHtml(!0,a.title,b)+a.content_html,d=a.open_handler,e=a.parent_dialog_container,g=a.parent_close_func,h=e?!0:!1,i=p.getModule("dialog"),j=p.getModule("event_manager"),k=q("<div>");if(k.addClass("greepf-common-container"),k.addClass(b+"container"),k.setAttribute("id",b+"container"),k.html(f.util.replaceMessage(c)),!i.changeContent(k,h))return f.enabledDEBUG&&f.debug({command:"Common.util.openDialog",message:"dialog open fail!"}),d.reset(),!1;var l=q("#"+b+"header-close");i.isModal()&&i.setCloseButtonElement(l);var m=function(){i.hide(),d.reset(),g&&g()};if(l.bindEvent("click",m),j.clearaddEventListener(b+"close-event",m),e){var n=q("#"+b+"header-back");n.show(),n.bindEvent("click",function(){e.show(),d.reset(),k.remove()}),e.hide()}},f.util.getExternalConfig=function(a){var b=!0,c=864e5;p.getModule("server_api").process("get_external_config",{app_id:p.config.app_id},function(b){a(b)},b,c)},f.util.useIframe=function(){return!f.isEmpty(p.getModule("game_container"))},f.util.getHostName=function(a){if(a){var b=a.match(/http:\/\/([a-z.\-0-9]+)\//);if(b)return b[1]}return void 0},f.util.config.replace_message_regex=/{\$([_a-z0-9]*).([_a-z0-9]*)}/gi,f.util.config.replace_message_regex_match=/{\$([_a-z0-9]*).([_a-z0-9]*)}/i,f.util.replaceMessage=function(a,b){var c,d,e;return b=b||p.config.msg,a.replace(f.util.config.replace_message_regex,function(a){return c=a.match(f.util.config.replace_message_regex_match),c&&3===c.length&&(d=c[1],e=c[2],b[d]&&b[d][e])?b[d][e]:""})},f.util.scrollTop=function(){f.util.scrollTo(1)},f.util.scrollTo=function(a){window.scrollTo(0,a)},f.util.getScrollY=function(){return window.pageYOffset},f.util.createOauthCallbackUrl=function(a){var b=p.getAppTopUrl(),c=a||p.getCurrentAppPageUrl();return b+f.getUrlSeparator(b)+f.convertUrlParams({url:c})},f.util.getCurrentPageCallbackUrl=function(){return f.util.isWebview()?p.getHttpRoot()+"?action=ggp_sdk_dialog_close":p.config.use_iframe?f.util.createOauthCallbackUrl():p.getCurrentAppPageUrl()},f.util.getSign=function(){var a="3legged";return p.getModule("callback")&&(a=p.getModule("callback").getSignMethod()),a},f.util.convertEmptyArrayToNull=function(a){if(f.isString(a)&&(a=a.split(",")),f.isArray(a)){var b=!0;f.loop(a,function(a){return f.isEmpty(a)?void 0:(b=!1,!1)}),b&&(a=null)}return a},f.util.getCallbackurlPropertyName=function(a){if(a&&f.isObject(a)){if("callback_url"in a)return"callback_url";if("callbackurl"in a)return"callbackurl";if("__callbackurl"in a)return"__callbackurl"}return null},f.util.convertCallbackUrl=function(a,b,c){if(!a||!b||b[f.util.getCallbackurlPropertyName(b)])return null;if(c&&f.isObject(c)){var d=!1;if(Object.keys(c).forEach(function(b){f.contains(a,b)&&(d=!0)}),d)return null;a+=f.getUrlSeparator(a),a+=f.convertUrlParams(c,!1)}return a},f.util.externalRedirect=function(a){if(f.util.isWebview()){var b=p.getModule("webview");b.executeCommand("showWebViewDialog",{URL:a})}else f.setLocationHref(a)},function(){var a={};a._modules={rpc:null},a.init=function(b){a._modules.rpc=p.getModule("rpc")},a.executeMultiple=function(b,c,d,e){a._modules.rpc.call("Ajax.executeMultiple",e,{url:b,act:c,params_list:d})},a.execute=function(b,c,d,e,f,g){var h=g?a._modules.rpc.callSecure:a._modules.rpc.call;h("Ajax.execute",e,{url:b,act:c,params:d,do_post:f})},p.addModule("ajax",a)}(),function(){var a={};a._listeners={},a._afterEach=null,a._validate=function(a){return a},a._validateListener=function(a,b){if(!f.isFunction(b))throw new g("error addEventListener. ["+a+"]");return!0},a.init=function(b){if(!a._validate(b))throw new g("[EventManager.init] validate error.");var c;Object.keys(b.event_attach).forEach(function(d){c=b.event_attach[d],c.forEach(function(b){f.isFunction(b)&&a.addEventListener(d,b)})}),b.afterEach&&f.isFunction(b.afterEach)&&(a._afterEach=b.afterEach)},a.removeaddEventListener=function(b,c,d){return a._validateListener(c,d)?(b&&b.bindEvent?b.bindEvent(c,d,!1):(a.removeEventListener(null,c,d),a.addEventListener(c,d)),!0):!1},a.clearaddEventListener=function(b,c){a.clearEventListener(b),a.addEventListener(b,c)},a.attachEvent=function(b,c,d){return a._validateListener(c,d)?(b&&b.bindEvent&&b.bindEvent(c,d,!1),a.addEventListener(c,d),!0):!1},a.addEventListener=function(b,c){return a._validateListener(b,c)?(a._listeners[b]||(a._listeners[b]=[]),a._listeners[b].push(c),!0):!1},a.removeEventListener=function(b,c,d){b&&b.removeEventListener&&b.removeEventListener(c,d,!1);var e=a._listeners[c];e&&f.loop(e,function(a){if(a===d){var b=e.indexOf(a);return e.splice(b,1),!1}})},a.clearEventListener=function(b){a._listeners[b]=[]},a.dispatchEvent=function(b){var c=a._listeners[b];if(c){var d=Array.prototype.slice.call(arguments,1);c.forEach(function(a){a.apply(null,d)})}a._afterEach&&a._afterEach(b)},a.dispatchGlobalEvent=function(a,b){var c=document.createEvent("Event");return c.initEvent(a,!0,!0),c.context=b,document.dispatchEvent(c),!0},p.addModule("event_manager",a)}(),function(){var a={};a._config={gree_container_id:null,create_container_trigger:null,css_id:"greepf_css",css_url:null},a._modules={event_manager:null},a._dom={gree_container:null},a._createContainer=function(){var b=document.createElement("div");return b.id=a._config.gree_container_id,a._setZoom(b),setTimeout(function(){a._setZoom(b)},300),b},a.init=function(b){return a._config.gree_container_id=p.config.gree_container_id,b.css_url&&(a._config.css_url=b.css_url),b.css_id&&(a._config.css_id=b.css_id),!0},a.createContainer=function(){q("#"+a._config.gree_container_id).isNotEmpty()?a._dom.gree_container||(a._dom.gree_container=q("#"+a._config.gree_container_id)):a._dom.gree_container?q("body").append(a._dom.gree_container):(q("body").append(a._createContainer()),a._dom.gree_container=q("#"+a._config.gree_container_id)),a._config.css_url&&!q("#"+a._config.css_id).isNotEmpty()&&a._createCss(),p.dispatchEvent("container_created")},a.getContainer=function(){return a._dom.gree_container},a._createCss=function(){if(p.config.css_dynamically_load){var b=document.createElement("link");b.id=a._config.css_id,b.type="text/css",b.rel="stylesheet",b.href=a._config.css_url,q("head").append(b)}p.dispatchEvent("css_loaded")},a._setZoom=function(b){var c,d=b.style.zoom,f=q("html").getCurrentStyle().zoom,g=q("body").getCurrentStyle().zoom,h=[f,g];for(var i in h)if(h[i]&&"1"!=h[i]){c=h[i];break}if(!c&&q("meta[name='viewport']").isNotEmpty()){var j=q("meta[name='viewport']").getAttribute("content");j=a._parseViewport(j);var k=parseInt(j.width),l=window.screen.width;e.androidIcs()&&!e.isModernChrome()&&(l/=window.devicePixelRatio),!isNaN(k)&&k>l&&(c=l/k)}c?b.style.zoom=1+(1-c)/c:d&&(b.style.zoom=1)},a._parseViewport=function(a){var b,c={},d=a.split(",");return d.forEach(function(a){b=a.match(/([-a-z]+)=([-a-z0-9.]+)/),b&&3==b.length&&(c[b[1]]=b[2])}),c},p.addModule("container_manager",a)}(),function(){function b(){this.host=null,this._api_list={}}b.prototype._validateParams=function(a,b){var c=[];return Object.keys(a.fields).forEach(function(d){f.isFunction(a.fields[d].validator)&&!a.fields[d].validator(b[d],b)&&c.push(d)}),c},b.prototype._convertParams=function(a,b){return Object.keys(a.fields).forEach(function(c){b[c]&&b[c].trim&&(b[c]=b[c].trim()),!f.isUndefined(b[c])&&f.isFunction(a.fields[c].convert)&&(b[c]=a.fields[c].convert(b[c],b)),f.isUndefined(b[c])&&delete b[c]}),b},b.prototype._deleteDisuseParams=function(a,b){var c=Object.keys(a.fields);return Object.keys(b).forEach(function(a){f.contains(c,a)||delete b[a]}),b},b.prototype._setAlternativeNameValue=function(a,b){return Object.keys(a.fields).forEach(function(c){f.isUndefined(b[c])&&(f.isFunction(a.fields[c].alternative_name_rule)?b=a.fields[c].alternative_name_rule(b):f.isArray(a.fields[c].alternative_names)&&f.loop(a.fields[c].alternative_names,function(a){return f.isUndefined(b[a])?void 0:(b[c]=b[a],!1)}))}),b},b.prototype._setDefaultValue=function(a,b){return Object.keys(a.fields).forEach(function(c){f.isUndefined(b[c])&&!f.isUndefined(a.fields[c].default_value)&&null!=a.fields[c].default_value&&(b[c]=a.fields[c].default_value),f.isUndefined(b[c])&&delete b[c]}),b},b._cache={},b._cache.createKey=function(b,c,d){var e,g;if(f.isObject(c)){if(f.isArray(d)){var h=f.copy(c);d.forEach(function(a){delete h[a]})}else h=c;e=JSON.stringify(h)}else e=c;return g=b+":"+a(e)},b._cache.isExpire=function(a){return a?f.getTime()>a.expire:!0},b._cache.get=function(a,c,d){b._cache.deleteExpireData();var e,f;return e=b._cache.createKey(a,c,d),f=k.get(j.API.CACHE),f&&!b._cache.isExpire(f[e])?f[e].res:void 0},b._cache.set=function(a,c,d,e,g){if(k.isAvailable()&&a){var h,i,l,m;h=f.getTime(),i=b._cache.createKey(c,d,g),l=k.get(j.API.CACHE),m={res:e,expire:h+a},l?(l[i]=m,k.set(j.API.CACHE,l)):(l={},l[i]=m,k.set(j.API.CACHE,l))}},b._cache.deleteExpireData=function(){var a,c;a=k.get(j.API.CACHE),a&&(delete_keys=[],c=Object.keys(a),c.forEach(function(c){
b._cache.isExpire(a[c])&&delete a[c]}),k.set(j.API.CACHE,a))},b._callbackWrap=function(a,c,d,e,h){return function(i){if(f.isFunction(a)){if(f.enabledDEBUG&&f.debug({command:"Api._callbackWrap",api:d,params:e,response:i}),i&&i.status)if("200"==i.status.code)b._cache.set(c,d,e,i,h);else{if("401"==i.status.code)throw p.dispatchEvent("unauthorized_error"),new g("401 Unauthorized");if("403"==i.status.code)throw p.dispatchEvent("forbidden_error"),new g("403 Forbidden");if("400"==i.status.code)throw p.dispatchEvent("bed_request_error"),new g("400 Bad Request")}return setTimeout(function(){a(i)},1),!0}return!1}},b.prototype.process=function(a,c,d,e,h,i){var j=f.copy(c),k=f.copy(c),l=d;if(d=b._callbackWrap(d,h,a,k,i),e){var m=b._cache.get(a,j,i);if(!f.isUndefined(m))return m.is_used_cache=!0,f.isFunction(l)&&l(m),void(f.enabledDEBUG&&f.debug({command:"Api.prototype.process",cache:!0,api:a,params:j,response:m}))}var n=this.get(a);if(!n)throw new g("not found api:"+a);j||(j={}),j=this._setAlternativeNameValue(n,j),j=this._setDefaultValue(n,j),j=this._deleteDisuseParams(n,j),j=this._convertParams(n,j);var o=this._validateParams(n,j);if(o.length>0)throw new g("validate error. ["+o.join(",")+"]");if(f.isFunction(n.edit_params)&&(j=n.edit_params(j,d,l)),f.isFunction(n.edit_callback)&&(d=n.edit_callback(d,k,j)),f.util.isWebview()&&f.isFunction(n.proton_command)){var p=this.getModule("webview"),q=n.proton_command(k);if(p.executeCommand(q,j,d))return}f.isFunction(n.executor)&&n.executor(j,d)},b.prototype.add=function(a,b){this._api_list[a]=b},b.prototype.get=function(a){return this._api_list[a]},b.prototype.getModule=function(a){return p.getModule(a)},b.prototype.getConfig=function(a){return p.config[a]},b.prototype.removeCacheByApiNameOnly=function(a){var b=k.get(j.API.CACHE);b&&(Object.keys(b).forEach(function(c){f.startsWith(c,a+":")&&delete b[c]}),k.set(j.API.CACHE,b))},b.prototype.removeCache=function(a,c){var d,e;d=k.get(j.API.CACHE),d&&(e=b._cache.createKey(a,c),delete d[e],k.set(j.API.CACHE,d))},b.prototype.clearCache=function(){k.remove(j.API.CACHE)},b.prototype.setHost=function(a){this.host=a},b.prototype.getHttpGreeRootUrl=function(){return"http://"+this.host+"/"},b.prototype.init=function(a){this.setHost(p.config.domain)},p.addModule("client_ui",new b),p.addModule("client_api",new b),p.addModule("server_api",new b)}(),function(){var a={};a.config={domain:null,id:null,app_id:null,target_id:null,secure_target_id:null,client_target_id:null,target_url:{},gree_container_id:null,limit_time:5e3},a.modules={event_manager:null},a.dom={iframe:{},target_win:{}},a.services={},a._timer={},a.callback={id:0,map:{}},a.util={},a.util.getAargements=function(){return Array.prototype.slice.apply(arguments[0])},a._queue={},a.register=function(b,c){a.services[b]=c},a.register("callback",function(b,c){var d=a.callback.map[b];d&&(delete a.callback.map[b],d(c))}),a.init=function(b){a.callback.id=0,a.callback.map={},a.config.domain=p.config.domain,a.config.id=b.id||"gree_parent",a.config.app_id=p.config.app_id,a.config.target_id=b.target_id||"gree_rpc",a.config.secure_target_id=b.secure_target_id||"gree_rpc_secure",a.config.client_target_id=b.client_target_id||p.config.client_rpc_target_id,a.config.allow_targets=[a.config.target_id,a.config.secure_target_id,a.config.client_target_id].concat(b.allow_targets),a.config.allow_targets=a.config.allow_targets.filter(function(a){return!f.isUndefined(a)}),a.config.target_url[a.config.target_id]=b.target_url||p.getHttpRoot()+"js/ggp/"+f.appendSuffix("gree_rpc",p.config.env)+".html",a.config.target_url[a.config.secure_target_id]=b.secure_target_url||f.appendUrlParmas(p.getHttpRoot(),{action:"ggp_sdk_rpc",app_id:p.config.app_id,origin:"http://"+document.location.hostname}),a._queue[a.config.target_id]=new f.Queue,a._queue[a.config.secure_target_id]=new f.Queue,a.config.gree_container_id=p.config.gree_container_id,b.register&&Object.keys(b.register).forEach(function(c){f.isFunction(b.register[c])&&a.register(c,b.register[c])}),window.addEventListener("message",a.onMessage,!1)},a.addAllowTarget=function(b){f.isUndefined(b)||f.contains(a.config.allow_targets,b)||a.config.allow_targets.push(b)},a.createIframe=function(b){if(!a.config.target_url[b])throw new g("[GREE] target_url not found. id:"+b);var c=q("#"+b);c&&c.isNotEmpty()&&c.remove();var d=document.createElement("iframe");return d.id=b,d.name=b,d.src=a.config.target_url[b],d.style.border="0px",d.style.margin="0px",d.style.display="block",d.style.width=0,d.style.height=0,d},a.postMessage=function(b,c,d){a.dom.target_win[b].postMessage(c,d)},a.onMessage=function(b){if(f.isString(b.data)){var c=h.parse(b.data);if(f.debug(function(){return"[rpc]"+b.data},!1),c&&f.isString(c.s)&&f.isString(c.f)&&f.isArray(c.a)&&a._isAllowFromId(c.f)&&a.services[c.s]){var d=a.util.getAargements(c.a);d.push(c.f),a.services[c.s].apply(null,d)}}},a._isAllowFromId=function(b){return f.contains(a.config.allow_targets,b)},a._isAllowToId=function(b){return b===a.config.id||"all"===b},a._isReady=function(b){return q("#"+b).isNotEmpty()&&a.dom.target_win[b]?!0:!1},a._prepare=function(b){if(!a.dom.iframe[b]){var c=q("#"+a.config.gree_container_id);if(c.isNotEmpty()){var d=a.createIframe(b);d&&c.append(d)}}},a._getTargetId=function(b){return b?a.config.secure_target_id:a.config.target_id},a._getQueue=function(b){return a.config.secure_target_id===b?a._secure_queue:a._queue},a.callSecure=function(b,c,d){a.call(b,c,d,a.config.secure_target_id)},a.callClient=function(b,c,d){a.call(b,c,d,a.config.client_target_id)},a.call=function(b,c,d,e){if(e||(e=a.config.target_id),!a._isReady(e))return a._queue[e].enqueue(arguments),void(a._timer[e]||(a._timer[e]=setTimeout(function(){a._queue[e].clear(),delete a._timer[e],c({code:0,message:"timeout"})},a.config.limit_time),a._prepare(e)));var f=null;c&&(f=a.callback.id=a.callback.id+1,a.callback.map[f]=c),a._call(e,b,c,f,d)},a.callCallback=function(b,c,d){b&&c&&a._call(b,"callback",null,c,d)},a._call=function(b,c,d,e){var f={s:c,f:a.config.id,t:b,a:Array.prototype.slice.call(arguments,3)};a.postMessage(b,h.stringify(f),"*")},a.register("rpc_start",function(b,c,d){a.config.target_id===d&&p.dispatchEvent("rpc_started",c),a.start(d)}),a.start=function(b){b?a._start(b):(target_ids=Object.keys(a.dom.iframe),target_ids.forEach(function(b){a._start(b)}))},a._start=function(b){if(a._timer[b]&&clearTimeout(a._timer[b]),a.dom.iframe[b]||(a.dom.iframe[b]=q("#"+b)),a._queue[b]||(a._queue[b]=new f.Queue),a.dom.iframe[b]&&a.dom.iframe[b].isNotEmpty()){a.dom.target_win[b]=a.dom.iframe[b].contentWin();for(var c,d=0;(c=a._queue[b].dequeue())&&(d++,5!==d);)a.call.apply(null,c)}},p.addModule("rpc",a)}(),function(){var a={};a._config={},a._state={origin_scroll_y:null,body_style_position:null},a._modules={container_manager:null},a._dom={container:null,gree_footer:null},a.isModal=function(){return!1},a._isExistContainer=function(){var b=a._modules.container_manager.getContainer();return b&&a._dom.container},a._createContainer=function(){var b,c;return(b=a._modules.container_manager.getContainer())?(c=document.createElement("div"),c.className="greepf-dialog-container",b.append(c),a._dom.container=q(".greepf-dialog-container"),!0):!1},a.init=function(b){a._modules.container_manager=p.getModule("container_manager")},a.reset=function(a){},a.changeContent=function(b,c){return b&&a._isExistContainer()||a._createContainer()?(c||a._dom.container.html(""),a._dom.container.append(b),b.addClass("greepf-dialog-ani-open"),!0):!1},a._showAppContainer=function(){document.body.style.position=a._state.body_style_position;var b=p.getAppContainer();b.isNotEmpty()&&b.show(),a._displayFooter(!0),f.util.scrollTo(a._state.origin_scroll_y)},a.hideAppContainer=function(){function b(){a._state.body_style_position=document.body.style.position,document.body.style.position="static",c.isNotEmpty()&&c.hide(),a._displayFooter(!1)}var c=p.getAppContainer(),d=a._getFooterDom();(c.isNotEmpty()&&c.isVisible()||d&&d.isNotEmpty()&&d.isVisible())&&(a._state.origin_scroll_y=f.util.getScrollY(),b()),f.util.scrollTop()},a._getFooterDom=function(){var a=q(".greepf-footer-container"),b=q("#_gree_footer");return a.isNotEmpty()?a:b.isNotEmpty()?b:null},a._displayFooter=function(b){(!a._dom.gree_footer||a._dom.gree_footer.isEmpty())&&(q("#_gree_footer").isNotEmpty()?a._dom.gree_footer=q("#_gree_footer"):q(".greepf-footer-container").isNotEmpty()&&(a._dom.gree_footer=q(".greepf-footer-container"))),a._dom.gree_footer&&a._dom.gree_footer.isNotEmpty()&&(b?a._dom.gree_footer.show():a._dom.gree_footer.hide())},a._getChildContainer=function(){if(a._dom.container&&a._dom.container.isNotEmpty()){var b;return f.loop(a._dom.container.firstChild.children,function(a){return""==a.style.display?(b=a,!1):void 0}),b}return void 0},a.show=function(){a.hideAppContainer();var b=a._getChildContainer();b&&(b.style.width=a._dom.container.getCurrentStyle().width,b.style.minHeight=window.innerHeight+"px",b.style.height="auto",b.style.display="")},a.hide=function(){a._showAppContainer();var b=a._getChildContainer();b&&(b.style.display="none")},a.close=function(){},p.addModule("dialog",a)}(),function(){var a={};a._config={sign:""},a.init=function(b){b.sign&&(a._config.sign=b.sign)},a.getSignMethod=function(){return a._config.sign},a.execute=function(a,b,c){if(!f.isEmpty(a)){if(a&&a.result){if("close"!=a.result||1===Object.keys(a).length)return;a=a.param}c||a&&a.data&&(a.data.hasOwnProperty("callback_url")?c=a.data.callback_url:a.data.hasOwnProperty("callbackurl")?c=a.data.callbackurl:a.data.hasOwnProperty("__callbackurl")&&(c=a.data.__callbackurl)),a&&a.data&&!a.callbackurl&&c&&(a.data.callbackurl=c,"callback_url"in a.data&&delete a.data.callback_url),!b(a)&&c&&f.util.requestLocation(c,!0)}},p.addModule("callback",a)}(),function(){var a=p.getModule("client_api");a.add("/thumbnail",{fields:{user_ids:{validator:function(a){return o.required(a)&&o.array(a)}}},edit_params:function(b){return{app_id:a.getConfig("app_id"),user_list:b.user_ids,format:"allsize"}},edit_callback:function(b){return function(c){a.getModule("callback").execute({data:c.data},b)}},executor:function(b,c){a.getModule("server_api").process("get_thumbnail",b,c)}})}(),function(){var a=p.getModule("client_api");a.add("/context",{fields:{},edit_callback:function(b){return function(c){c=c||{};var d=c.result||{};d.use_iframe=f.util.useIframe(),a.getModule("callback").execute({data:d},b)}},proton_command:function(a){return"getRuntimeInfo"},executor:function(a,b){b&&b({result:{user_agent:window.navigator.userAgent}})}})}(),function(){var a=p.getModule("client_api");a.add("/purchase",{fields:{product_id:{validator:function(a){return o.required(a)}}},edit_callback:function(b){return function(c){a.getModule("callback").execute({data:c},b)}},proton_command:function(a){return"purchaseProduct"},executor:function(a,b){f.warn("This interface for WebviewAPI use only. [/purchase]")}})}(),function(){var a=p.getModule("client_api");a.add("/purchase/products",{fields:{},edit_callback:function(b){return function(c){a.getModule("callback").execute({data:c},b)}},proton_command:function(a){return"getProducts"},executor:function(a,b){f.warn("This interface for WebviewAPI use only. [/purchase/products]")}})}(),function(){var a=p.getModule("client_ui");a.add("request",{fields:{title:{},body:{},list_type:{convert:function(a){return a&&!f.contains(["all","joined","specified"],a)?"all":a},default_value:"all"},to_user_id:{alternative_names:["to_user_ids"],convert:function(a){return f.util.convertEmptyArrayToNull(a)},validator:function(a,b){var c=!0;return a&&(c=o.array(a)),c}},expire_time:{},callbackurl:{alternative_names:["callback_url"]},redirect_url:{},touch_url:{},mobile_url:{},device_custom_urls:{},social_graph_name:{},attrs:{},notification_mail:{},awakening:{},image_url:{},touch_image:{}},edit_params:function(b,c,d){var e=a.getModule("placeholder");if(b.app_id=a.getConfig("app_id"),b.title=e.replace(b.title),b.body=e.replace(b.body),b.touch_url=b.touch_url||b.redirect_url,b.touch_image=b.touch_image||b.image_url,"specified"===b.list_type&&f.isEmpty(b.to_user_id)&&(b.list_type="all"),f.isEmpty(b.to_user_id)||(b.list_type="specified"),f.util.isWebview())return{request:b};var g=f.util.getCallbackurlPropertyName(b);return d&&g&&delete b[g],b},edit_callback:function(b,c){return function(d){f.util.isWebview()||a.getModule("request").closeDialog();var e;if(d.data){var g={request_id:d.data.request_id?d.data.request_id:""};d.data.send_status&&f.isObject(d.data.send_status)&&Object.keys(d.data.send_status).forEach(function(a){g["st_"+a]=d.data.send_status[a]?d.data.send_status[a].join(","):""});var h=f.util.getCallbackurlPropertyName(c);e=f.util.convertCallbackUrl(c[h],d.data,g)}a.getModule("callback").execute(d,b,e)}},proton_command:function(a){return"showRequestDialog"},executor:function(b,c){b.to_user_ids=b.to_user_id,delete b.to_user_id,a.getModule("event_manager").clearaddEventListener("request_commited",c),a.getModule("request").openDialog(b)}})}(),function(){var a=p.getModule("client_ui");a.add("invite",{fields:{body:{},to_user_ids:{alternative_names:["to_user_id"],convert:function(a){return f.util.convertEmptyArrayToNull(a)},validator:function(a,b){var c=!0;return a&&(c=o.array(a)),c}},callbackurl:{alternative_names:["callback_url"]},social_graph_name:{},view:{}},edit_params:function(b,c,d){if(b.app_id=a.getConfig("app_id"),f.util.isWebview())return b.to_user_ids&&(b.to_user_id=b.to_user_ids,delete b.to_user_ids),{invite:b};var e=f.util.getCallbackurlPropertyName(b);return d&&e&&delete b[e],b},edit_callback:function(b,c){return function(d){f.util.isWebview()||a.getModule("invite").closeDialog();var e;if(d.data){var g={invite_member:d.data.recipient_user_ids?d.data.recipient_user_ids.join(","):""},h=f.util.getCallbackurlPropertyName(c);e=f.util.convertCallbackUrl(c[h],d.data,g)}a.getModule("callback").execute(d,b,e)}},proton_command:function(a){return"showInviteDialog"},executor:function(b,c){a.getModule("event_manager").clearaddEventListener("invite_commited",c),a.getModule("invite").openDialog(b)}})}(),function(){var a=p.getModule("client_ui");a.add("upgrade",{fields:{grade:{},callback_url:{}},edit_params:function(a){return a.target_grade=a.grade,delete a.grade,a},edit_callback:function(b){return function(c){if("success"==c.result){var d={data:{upgraded:!0}};a.getModule("callback").execute(d,b)}}},proton_command:function(a){return"needUpgrade"},executor:function(b,c){a.getModule("upgrade").show(b)}})}(),function(){var a=p.getModule("client_ui");a.add("share",{fields:{message:{alternative_names:["body"],validator:function(a){var b=o.required(a);return b?o.string(a):!0}},on:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}},image_urls:{alternative_name_rule:function(a){return["image_urls_640","image_urls_240","image_urls_75"].forEach(function(b){if(!f.isUndefined(a[b])){var c=b.replace("image_urls_","");a.image_urls=a.image_urls||{},a.image_urls[c]=a[b]}}),a},validator:function(a){var b=o.required(a);return b?o.object(a):!0}},callback_url:{alternative_names:["callbackurl"],validator:function(a){var b=o.required(a);return b?o.string(a):!0}},options:{validator:function(a){var b=o.required(a);return b?o.object(a):!0}},snapid:{},old_tag:{}},edit_params:function(b,c,d){var e=a.getModule("webview");if("facebook"==b.on&&delete b.message,("twitter"==b.on||"facebook"==b.on)&&e&&e.enabledShowWebViewDialog()){var g,h,i=b.message?"&message="+encodeURIComponent(b.message):null,j=b.options?"&options="+encodeURIComponent(JSON.stringify(b.options)):null,k=b.image_urls?"&image_urls="+encodeURIComponent(JSON.stringify(b.image_urls)):null,l=b.snapid?"&snapid="+b.snapid:null;return"twitter"==b.on?(g="share_twitter_url",h="ggp_share_twitter"):"facebook"==b.on&&(g="share_facebook_url",h="ggp_share_facebook"),{URL:[p.config.context[g],"&app_id=",p.config.app_id,i,j,k,l].join("")}}b.type="normal",b.app_id=p.config.app_id,b.image_urls=f.util.isWebview()?JSON.stringify(b.image_urls):b.image_urls;var m=f.util.getCallbackurlPropertyName(b);return d&&m&&delete b[m],b},edit_callback:function(b,c,d){return function(d){var e=null;if(f.util.isWebview())if("twitter"==c.on||"facebook"==c.on){if("close"!=d.result&&0!=d.result)return;d=d.param?d.param:d.data&&d.data.message?{data:d.data}:d.data,e=d.data}else e=d.param?d.param.data:void 0;else a.getModule("share").closeDialog(),e=d.data;var g=f.util.getCallbackurlPropertyName(c),h=null;h=c.old_tag?c[g]?c[g]:null:f.util.convertCallbackUrl(c[g],e,{shared_with:e.shared_with?e.shared_with.join(","):""}),a.getModule("callback").execute(d,b,h)}},proton_command:function(b){if("twitter"==b.on||"facebook"==b.on){var c=a.getModule("webview");if(c.enabledShowWebViewDialog())return p.config.uamode&&"facebook"==b.on?"showDashboard":"showWebViewDialog"}return"showShareDialog"},executor:function(b,c){a.getModule("event_manager").clearaddEventListener("share_commited",c);var d=a.getModule("share");b.on?d.Extend.External.openDialog(b):d.openDialog(b)}})}(),function(){var a=p.getModule("client_ui");a.add("open",{fields:{view:{validator:function(a){return o.required(a)}},user_id:{validator:function(a,b){return"profile"===b.view?o.required(a):!0}},community_id:{validator:function(a,b){return"community"===b.view?o.required(a):!0}},thread_id:{},id:{},url:{validator:function(a,b){return"container"===b.view?o.required(a):!0}},campaign_id:{validator:function(a,b){return"xapp"===b.view?o.required(a):!0}}},_view:null,edit_params:function(b){var c=b.view;if(this._view=c,"dashboard"==c){var d;return b.url&&f.util.isGreeDomain(b.url)&&(d=b.url),d||(d=a.getConfig("context").dashboard_url+a.getConfig("app_id")),{URL:d}}if("community"==c){var e=["community",b.community_id,b.thread_id].join("/");return{URL:a.getConfig("context").http_root_gree_net+e}}if("profile"==c)return{URL:a.getConfig("context").http_root_gree_net+"profile/"+b.user_id};if("container"==c)return{url:b.url};if("market"==c){var g,h;return b.id&&(g=b.id.ios?"http://itunes.apple.com/jp/app/id"+b.id.ios+"?mt=8":"",h=b.id.android?"https://play.google.com/store/apps/details?id="+b.id.android:""),{URL:"greeappXXX://skip",ios_src:g,android_src:h}}if("market_review"==c){var g=b.id.ios?"http://itunes.apple.com/WebObjects/MZStore.woa/wa/viewContentsUserReviews?id="+b.id.ios+"&mt=8&type=Purple+Software":"",h=b.id.android?"https://play.google.com/store/apps/details?id="+b.id.android:"";return{URL:"greeappXXX://skip",ios_src:g,android_src:h}}if("app_setting"==c){var e=["app/info/setting/view",a.getConfig("app_id")].join("/");return{URL:a.getConfig("context").dashboard_url+e}}if("gree_app_menu"==c&&f.util.isWebview()){var e=[a.getConfig("app_id"),"info","menu"].join("/");return{URL:a.getConfig("context").http_root_apps+e+"/"}}if("help"==c){var d=f.appendUrlParmas(a.getConfig("context").http_root_help,{action:"app_form",app_id:a.getConfig("app_id")});return{URL:d}}return"logout"==c?{}:b},edit_callback:function(b){return function(c){a.getModule("callback").execute(c,b)}},proton_command:function(a){return this._getMethod()},executor:function(b,c){if("gree_app_menu"===b.view&&!f.util.isWebview())return void f.warn("This interface for WebviewAPI use only. [gree_app_menu]");var d=this._getMethod(),e=a.getModule("open");f.isFunction(e[d])&&("launchNativeApp"===d&&a.getModule("event_manager").clearaddEventListener("launch_native_app_error",function(a){c(a)}),e[d](b,c))},_getMethod:function(){var a=null;switch(this._view){case"dashboard":case"profile":case"community":case"app_setting":case"gree_app_menu":case"help":a="showDashboard";break;case"container":a="requestLocation";break;case"market":case"market_review":a="launchNativeApp";break;case"logout":a="logout";break;case"xapp":a="xapp"}return a}})}(),function(){var a=p.getModule("client_ui");a.add("request_image_proxy",{fields:{urls:{validator:function(a){return o.required(a)}}},executor:function(b,c){var d,e=[];for(var g in b.urls)d=f.appendUrlParmas(p.config.context.http_root_cpf+"px/"+p.config.app_id,{url:b.urls[g]},!1),e.push(d);a.getModule("callback").execute(e,c)}})}(),function(){var a=p.getModule("client_ui");a.add("request_location",{fields:{url:{validator:function(a){return o.required(a)}}},executor:function(a,b){f.util.requestLocation(a.url,!0)}})}(),function(){var a=p.getModule("client_ui");a.add("deposit-product",{fields:{view:{},other_app_id:{}},edit_params:function(b,c){var d=null,e=this._command(b),g=a.getConfig("app_id");if("showDashboard"===e){var h=a.getConfig("context").http_root_tpay,i=h;f.util.isWebview()?d={URL:i,close:function(b){a.getModule("callback").execute({data:{}},c)}}:(i=f.appendUrlParmas(i,{backto:f.util.createOauthCallbackUrl()}),d={URL:i})}else"showDepositProductDialog"===e&&(d={applicationId:b.other_app_id?b.other_app_id:g});return d},edit_callback:function(b,c){var d=this._command(c);return"showDashboard"!=d?function(c){a.getModule("callback").execute({data:{}},b)}:null},proton_command:function(a){return this._command(a)},executor:function(b,c){a.getModule("open").showDashboard(b)},_command:function(a){var b="";return b=f.util.isWebview()?"showDepositProductDialog":"showDashboard"}})}(),function(){var a=p.getModule("client_ui");a.add("wallet",{fields:{nativecmd:{}},edit_callback:function(b,c){return function(d){this._is_balance(c)&&(d={data:d.result}),a.getModule("callback").execute(d,b)}},proton_command:function(a){return this._is_balance(a)?"getWalletBalance":null},executor:function(a,b){f.warn("This interface for WebviewAPI use only. [wallet]")},_is_balance:function(a){return"balance"==a.nativecmd}})}(),function(){var a=p.getModule("client_ui");a.add("attention",{fields:{page:{validator:function(a){return o.required(a)}}},edit_params:function(b){if(f.util.isWebview()){var c=f.appendUrlParmas(a.getConfig("context").http_root_pf,{action:"ggp_service_attention",page:b.page});return{URL:c,size:[95,95]}}return b},edit_callback:function(b){return function(c){a.getModule("callback").execute(c,b)}},proton_command:function(a){return"showWebViewDialog"},executor:function(b,c){a.getModule("event_manager").clearaddEventListener("attention_closed",c),a.getModule("attention").openDialog(b)}})}(),function(){var a=p.getModule("client_ui");a.add("calendar",{fields:{type:{validator:function(a){return o.required(a)}},callback_url:{}},edit_params:function(b){if(f.util.isWebview()){var c=f.appendUrlParmas(a.getConfig("context").http_root_pf,{action:"ggp_calendar",app_id:a.getConfig("app_id"),type:b.type});return{URL:c}}return b.url=f.appendUrlParmas(a.getConfig("context").http_root_pf,{action:"ggp_calendar",app_id:a.getConfig("app_id"),type:b.type,js_sdk_ver:"2.0"}),b},edit_callback:function(b){return function(c){a.getModule("callback").execute(c,b)}},proton_command:function(a){return"showDashboard"},executor:function(b,c){a.getModule("event_manager").clearaddEventListener("calendar_closed",c),a.getModule("calendar").openDialog(b)}})}(),function(){var a=p.getModule("client_ui");a.add("mail",{fields:{type:{},subject:{},body:{},show_type:{},url:{}},edit_params:function(a){return"invite"!=a.type?{subject:a.subject,body:a.body}:a},proton_command:function(a){return"invite"!=a.type?"launchMailer":null},executor:function(b,c){"invite"!=b.type?(a.getModule("event_manager").clearaddEventListener("mailer_launched",c),a.getModule("open").launchMailer(b)):a.getModule("server_api").process("get_external_service",{app_id:a.getConfig("app_id"),app_type:"mail",type:b.type,subject:b.subject,body:b.body,show_type:b.show_type,url:b.url},function(b){return 1!=b.result?void f.debug(function(){return{command:"api.get_external_service",message:JSON.stringify(b)}}):void a.getModule("client_ui").process("mail",{subject:b.subject,body:b.body},c)})}})}(),function(){var a=p.getModule("client_ui");a.add("line",{fields:{type:{validator:function(a){return a?f.contains(["invite"],a):!0},default_value:"invite"},body:{},show_type:{},url:{}},edit_params:function(a){return a.app_type="line",a},executor:function(b,c){a.getModule("service_external").execute(b)}})}(),function(){var a=p.getModule("client_ui");a.add("invite_external_user",{fields:{service:{validator:function(a){return o.required(a)}}},edit_params:function(b){var c=a.getConfig("context").dialog_dashboard_url,d=a.getConfig("context").http_root_pf,e=a.getConfig("app_id"),f=c+"#view=findfriends_"+b.service+"&app_id="+e;return f+="&back_to="+encodeURIComponent(d+e),{URL:f}},proton_command:function(a){return"inviteExternalUser"},executor:function(a,b){a.URL&&f.setLocationHref(a.URL)}})}(),function(){var a=p.getModule("client_ui");a.add("sms",{fields:{to:{},body:{}},edit_params:function(a){return a.method="sms",a},proton_command:function(a){return"launchSMSComposer"},executor:function(a,b){f.warn("This interface for WebviewAPI use only. [sms]")}})}(),function(){var a=p.getModule("client_ui");a.add("control-sound",{fields:{action:{},type:{},name:{},duration:{},volume:{},loop:{}},edit_params:function(a,b){return a.method="control-sound",a},edit_callback:function(b){return function(c){if("success"==c.result||"fail"==c.result){var d=c.param;a.getModule("callback").execute(d,b)}}},proton_command:function(a){return"controlSound"},executor:function(a,b){f.warn("This interface for WebviewAPI use only. [control-sound]")}})}(),function(){var a=p.getModule("client_ui");a.add("facebook",{fields:{type:{},body:{},url:{},callback_url:{},append_invite_description:{},invite_description:{}},edit_params:function(a,b,c){a.on="facebook";var d=f.util.getCallbackurlPropertyName(a);return c&&d&&delete a[d],a},edit_callback:function(b,c){return function(d){a.getModule("share").closeDialog();var e;if(d.data){var g=f.util.getCallbackurlPropertyName(c);e=f.util.convertCallbackUrl(c[g],d.data,{shared_with:d.data.shared_with?d.data.shared_with.join(","):""})}a.getModule("callback").execute(d,b,e)}},executor:function(b,c){a.getModule("event_manager").clearaddEventListener("share_commited",c);var d=a.getModule("share");d.Extend.External.openDialog(b)}})}(),function(){var a=p.getModule("client_ui");a.add("twitter",{fields:{type:{},message:{alternative_names:["body"]},url:{},callback_url:{}},edit_params:function(a,b,c){a.on="twitter";var d=f.util.getCallbackurlPropertyName(a);return c&&d&&delete a[d],a},edit_callback:function(b,c){return function(d){a.getModule("share").closeDialog();var e;if(d.data){var g=f.util.getCallbackurlPropertyName(c);e=f.util.convertCallbackUrl(c[g],d.data,{shared_with:d.data.shared_with?d.data.shared_with.join(","):""})}a.getModule("callback").execute(d,b,e)}},executor:function(b,c){a.getModule("event_manager").clearaddEventListener("share_commited",c);var d=a.getModule("share");d.Extend.External.openDialog(b)}})}(),function(){var a=p.getModule("client_ui");a.add("navigation-bar",{fields:{visible:{},animation:{}},edit_params:function(a,b,c){return a.method="navigation-bar",a},proton_command:function(a){return"showWaNavigationBar"},executor:function(a,b){f.warn("This interface for WebviewAPI use only. [navigation-bar]")}})}(),function(){var a=p.getModule("client_ui");a.add("external_invite",{fields:{},executor:function(b,c){a.getModule("external_invite").openDialog(b)}})}(),function(){var a=p.getModule("server_api");a.add("heartbeat",{meta:{act:"api_sdk_heartbeat"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},analytics:{default_value:""},session_utime:{default_value:""},friends_count:{default_value:""},append_context:{default_value:1},append_app_info:{default_value:1},app_type:{default_value:"sp"},update_lastaccess:{default_value:1},append_get_params:{}},executor:function(b,c){var d=a.getHttpGreeRootUrl(),e=!0;b.append_get_params&&(d=f.appendUrlParmas(d,b.append_get_params,!1),delete b.append_get_params),a.getModule("ajax").execute(d,this.meta.act,b,c,e)}})}(),function(){var a=p.getModule("server_api");a.add("get_request_user_list",{meta:{act:"api_sdk_request_user_list"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},list_type:{default_value:"all"},to_user_ids:{validator:function(a){return a?o.array(a):!0}},limit:{validator:function(a){return a?o.numeric(a):!0},default_value:15},offset:{validator:function(a){return a?o.numeric(a):!0},default_value:0},append_thumbnail:{default_value:1}},executor:function(b,c){b.to_user_ids&&(b.to_user_ids=b.to_user_ids.join(",")),a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("get_invite_user_list",{meta:{act:"api_sdk_invite_user_list"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},list_type:{default_value:"all"},to_user_ids:{validator:function(a){return a?o.array(a):!0},default_value:""},limit:{validator:function(a){return a?o.numeric(a):!0},default_value:16},offset:{validator:function(a){return a?o.numeric(a):!0},default_value:0},select_app_id:{},append_app_setting:{default_value:0},append_thumbnail:{default_value:1}},executor:function(b,c){b.to_user_ids&&(b.to_user_ids=b.to_user_ids.join(",")),a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("get_thumbnail",{meta:{act:"api_sdk_thumbnail"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},user_list:{validator:function(a){return o.required(a)&&o.array(a)}},format:{}},executor:function(b,c){var d=a.getModule("thumbnail_cache"),e=b.format||"specific_size",g=d[e].get(b.user_list),i=d[e].util.getNotCacheUserList(g,b.user_list);f.isEmpty(i)?c(d[e].util.formatResponse(g)):(b.user_list=encodeURIComponent(h.stringify(i)),a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,function(a){d[e].set(a),a=d[e].util.mergeResponse(g,a),c(a)}))}})}(),function(){var a=p.getModule("server_api");a.add("commit_request",{meta:{act:"api_sdk_request_commit"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},list_type:{validator:function(a){return o.required(a)}},to_user_ids:{validator:function(a){return o.required(a)&&o.array(a)}},title:{},body:{},callback_url:{},mobile_image:{},touch_image:{},mobile_url:{},touch_url:{},expire_time:{},device_custom_urls:{},attrs:{},incentive_payload:{},social_graph_name:{},notification_mail:{},push_body:{},awakening:{},image_url:{},touch_image:{}},edit_params:function(a){return a.sign=f.util.getSign(),a.to_user_ids=a.to_user_ids.join(","),a},executor:function(b,c){var d=!0,e=!0;a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("commit_invite",{meta:{act:"api_sdk_invite_commit"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},to_user_ids:{validator:function(a){return o.required(a)&&o.array(a)}},invitee_token_list:{validator:function(a){return o.required(a)&&o.array(a)}},body:{},callback_url:{},incentive_payload:{},social_graph_name:{},view:{}},edit_params:function(a){return a.sign=f.util.getSign(),a.to_user_ids=a.to_user_ids.join(","),a},executor:function(b,c){var d=!0,e=!0;a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("get_footer_data",{meta:{act:"api_sdk_footer_lite"},fields:{app_id:{validator:function(a){return o.required(a)}},use_iframe:{default_value:1},append_footer:{default_value:0},append_get_params:{}},executor:function(b,c){var d=a.getHttpGreeRootUrl(),e=!0;b.append_get_params&&(d=f.appendUrlParmas(d,b.append_get_params),delete b.append_get_params),a.getModule("ajax").execute(d,this.meta.act,b,c,e)}})}(),function(){var a=p.getModule("server_api");a.add("callbackurl",{meta:{act:"api_callbackurl"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},url:{validator:function(a){return o.required(a)}},sign:{}},executor:function(b,c){var d,e;d=!1,e=!0,a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_commit",{meta:{act:"api_sdk_share_commit"},fields:{app_id:{validator:function(a){
return o.required(a)&&o.numeric(a)}},message:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}},image_url_640:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},image_url_240:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},image_url_75:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},facebook_share:{validator:function(a){var b=o.required(a);return b?o.numeric(a):!0},default_value:0},twitter_share:{validator:function(a){var b=o.required(a);return b?o.numeric(a):!0},default_value:0},callback_url:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}},snapid:{}},edit_params:function(a){return a.sign=f.util.getSign(),a},executor:function(b,c){var d=!0,e=!0;a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_facebook_auth",{meta:{act:"api_sdk_share_facebook_auth"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},backto:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}}},executor:function(b,c){var d=!1,e=!0;a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_facebook_confirm",{meta:{act:"api_sdk_share_facebook_confirm"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}}},executor:function(b,c){var d=!1,e=!0;a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_facebook_commit",{meta:{act:"ggp_share_facebook_commit"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},body:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}},url:{},image_url_640:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},image_url_240:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},image_url_75:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},type:{}},executor:function(b,c){var d=!0,e=!0;a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_facebook_description",{meta:{act:"api_sdk_share_facebook_description"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},message:{}},executor:function(b,c){a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("invite_facebook_commit",{meta:{act:"ggp_invite_facebook_commit"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},body:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}},message:{}},executor:function(b,c){var d=!0,e=!0;a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_twitter_auth",{meta:{act:"api_sdk_share_twitter_auth",url:function(){return"http://"+a.host}},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},backto:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}}},executor:function(b,c){var d=!1,e=!0;a.getModule("ajax").execute(this.meta.url(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_twitter_confirm",{meta:{act:"api_sdk_share_twitter_confirm",url:function(){return"http://"+a.host}},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}}},executor:function(b,c){var d=!1,e=!0;a.getModule("ajax").execute(this.meta.url(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("share_twitter_commit",{meta:{act:"ggp_share_twitter_commit",url:function(){return"http://"+a.host}},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},body:{validator:function(a){var b=o.required(a);return b?o.string(a):!0}},url:{},image_url_640:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},image_url_240:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""},image_url_75:{validator:function(a){var b=o.required(a);return b?o.string(a):!0},default_value:""}},executor:function(b,c){var d=!0,e=!0;a.getModule("ajax").execute(this.meta.url(),this.meta.act,b,c,d,e)}})}(),function(){var a=p.getModule("server_api");a.add("xapp",{meta:{act:"ggp_service_xapp"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},campaign_id:{validator:function(a){return o.required(a)}}},executor:function(b,c){a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("get_attention_html",{meta:{act:"ggp_service_attention"},fields:{page:{validator:function(a){return o.required(a)}},json:{default_value:1}},executor:function(b,c){a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("get_calendar_html",{meta:{act:"ggp_calendar"},fields:{app_id:{validator:function(a){return o.required(a)}},type:{},callback_url:{},json:{default_value:1}},executor:function(b,c){a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("get_external_service",{meta:{act:"ggp_service_external"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},app_type:{validator:function(a){return o.required(a)}},type:{},body:{},subject:{},url:{},show_type:{}},executor:function(b,c){a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("get_external_config",{meta:{act:"api_sdk_external"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},view:{}},executor:function(b,c){a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c)}})}(),function(){var a=p.getModule("server_api");a.add("sdk_callbackurl",{meta:{act:"api_sdk_callbackurl"},fields:{app_id:{validator:function(a){return o.required(a)&&o.numeric(a)}},url:{validator:function(a){return o.required(a)}},sign:{},app_type:{validator:function(a){return o.required(a)}}},executor:function(b,c){var d,e;d=!1,e=!0,a.getModule("ajax").execute(a.getHttpGreeRootUrl(),this.meta.act,b,c,d,e)}})}(),function(){var a={};a._config={app_id:null,app_config:null,timespan:null,append_list:[]},a._modules={analytics_log_module:null,api:null},a._getDelayTime=function(b){var c,d,e;return c=k.get(j.APP.HEARTBEAT_TIME)||0,e=c+a._config.timespan,d=b>e?1:e-b},a._append_params=function(b){if(f.isArray(a._config.append_list)){var c,d={};a._config.append_list.forEach(function(a){if(f.isFunction(a)&&(c=a(),c&&2==c.split("=").length)){var b=c.split("=");d[b[0]]=b[1]}}),Object.keys(d).length>0&&(b.append_get_params=d)}return b},a.init=function(b){a._config.app_id=p.config.app_id,a._config.timespan=6e5,a._modules.analytics_log_module=p.getModule("analytics_log"),a._modules.api=p.getModule("server_api"),f.isEmpty(b)||(a._config.append_list=b.append_list),a._config.append_list.push(function(){return"ver="+p.config.js_ver}),a._config.append_list.push(function(){return"appid="+p.config.app_id}),a._config.append_list.push(function(){return"ifr="+p.config.use_iframe})},a._handler={},a._handler.run=f.createExecuteOnceHandler(function(){var b=k.get(j.APP.CONFIG);b&&b.context||k.set(j.APP.HEARTBEAT_TIME,0),a._run()}),a.run=a._handler.run.execute,a._run=function(){var b=f.getTime();a._timer=window.setTimeout(function(){a._timer=null,a.execute(),a._handler.run.reset()},a._getDelayTime(b))},a.execute=function(){var b=a._modules.analytics_log_module.get(),c=p.config,d=a._append_params({app_id:a._config.app_id,analytics:b,session_utime:c.session_utime,friends_count:c.friends_count,app_type:c.app_type,append_context:c.context?0:1,append_app_info:c.app_name?0:1,update_lastaccess:c.use_iframe&&c.app_type===p.constant.app_type.SMARTPHONE?0:1});a._modules.api.process("heartbeat",d,function(b){return 200!=b.status.code?(f.debug("heatbeat fail!"),void(a._timer&&k.set(j.APP.HEARTBEAT_TIME,0))):(k.set(j.APP.HEARTBEAT_TIME,f.getTime()),a._modules.analytics_log_module.clear(),void p.dispatchEvent("heartbeat_executed",b.data,b.is_changed_friends,b.is_updated_session))})},p.addModule("heartbeat",a)}(),function(){var a={};a._config={app_id:null,add_type:null},a._modules={api:null},a.get=function(){var a=k.get(j.APP.ANALYTICS);return f.isArray(a)?a:[]},a.clear=function(){k.remove(j.APP.ANALYTICS),f.debug("AnalyticsLog.clear")},a.init=function(b){a._config.app_id=p.config.app_id,a._modules.api=p.getModule("server_api")},a.add=function(){var b=parseInt(f.getTime()/1e3);k.set(j.APP.ANALYTICS,a.get().concat(b)),f.debug("AnalyticsLog.add")},p.addModule("analytics_log",a)}(),function(){var a={};a._const={AUTH_SUCCESS:2e3,AUTH_REDIRECT:3e3,AUTH_FORBIDDEN_ERROR:4e3},a._config={app_id:null,share_num:98,origin_params:null},a._config.main_html=String()+"<div class='greepf-share-unit'><div class='greepf-share-description'></div><textarea class='greepf-share-txt-area'></textarea></div><div class='greepf-share-unit-last'><div class='greepf-share-flex'><div class='greepf-share-itm-left'><div id='greepf-share-twitter' class='greepf-share-twitter-disable'></div></div><div class='greepf-share-itm-right-mini'><div class='greepf-share-num'></div></div><div class='greepf-share-itm-right-mini'><div class='greepf-share-submit-button'>{$share.submit_button}</div></div></div></div>",a._config.invite_desc_html=String()+"<hr class='greepf-share-invite-desc-separate'><div class='greepf-share-invite-desc-content'><div class='greepf-share-invite-desc-icon'><div class='greepf-share-invite-desc-icon-image' style='background-image:url({$custom.icon_url})'></div></div><div class='greepf-share-invite-desc-message'><div class='greepf-share-invite-desc-title'>{$custom.title}</div><div class='greepf-share-invite-desc-body'>{$custom.body}</div></div></div>",a.init=function(b){a._modules.dialog=p.getModule("dialog"),a._modules.event_manager=p.getModule("event_manager"),a._modules.api=p.getModule("server_api"),a._config.app_id=p.config.app_id},a._openDialogHandler=f.createExecuteOnceHandler(function(b,c){a._config.origin_params=f.copy(b),f.util.prepareOpenDialog({prefix:"greepf-share-",content_html:a._config.main_html,title:p.config.msg.share.header_title,open_handler:a._openDialogHandler,parent_dialog_container:c.dialog_container,parent_close_func:c.close_func}),a._util.setDom(),a._util.setDefault(),a.bindImage(),a._modules.dialog.show(),a._dom.container.show(),a._dom.ext_twitter.show(),a._dom.description.hide(),a._modules.event_manager.removeaddEventListener(a._dom.message,"input",a._listener.change),a._modules.event_manager.removeaddEventListener(a._dom.submit_button,"click",a._handler.submit.listener),a._modules.event_manager.removeaddEventListener(a._dom.ext_twitter,"click",a._listener.twitter)}),a.openDialog=a._openDialogHandler.execute,a.closeDialog=function(){if(a._modules.event_manager.dispatchEvent("greepf-share-close-event"),a.Extend&&f.isObject(a.Extend.External))for(var b in a.Extend.External)f.isFunction(a.Extend.External[b].closeDialog)&&a.Extend.External[b].closeDialog()},a.Ext={Twitter:{}},a.Ext.auth=function(b){var c={app_id:a._config.app_id,backto:f.util.getCurrentPageCallbackUrl()};b.extend_params&&f.extend(c,b.extend_params),a._modules.api.process(b.api_name,c,function(c){switch(c.status_code){case a._const.AUTH_SUCCESS:b.success(c);break;case a._const.AUTH_REDIRECT:a.closeDialog(),f.util.externalRedirect(c.data.url);break;case a._const.AUTH_FORBIDDEN_ERROR:default:b.failure(c)}})},a.Ext.confirm=function(b){var c={app_id:a._config.app_id};b.extend_params&&f.extend(c,b.extend_params),a._modules.api.process(b.api_name,c,function(a){switch(a.status_code){case 2e3:b.success(a);break;default:b.failure(a)}})},a.Ext.Twitter.auth_default_options={api_name:"share_twitter_auth",success:function(b){a.Ext.Twitter.enable()},failure:function(b){a.Ext.Twitter.disable()}},a.Ext.Twitter.confirm_default_options={api_name:"share_twitter_confirm",success:function(b){a.Ext.Twitter.enable()},failure:function(b){a.Ext.Twitter.disable()}},a.Ext.Twitter.enable=function(){a._state.twitter_share=1,a._dom.ext_twitter.addClass("greepf-share-twitter"),a._dom.ext_twitter.removeClass("greepf-share-twitter-disable")},a.Ext.Twitter.disable=function(){a._state.twitter_share=0,a._dom.ext_twitter.removeClass("greepf-share-twitter"),a._dom.ext_twitter.addClass("greepf-share-twitter-disable")},a._state={dialog_open_time:null,twitter_share:0},a._modules={dialog:null,event_manager:null,api:null},a._handler={},a._listener={},a._listener.close=function(){a._modules.event_manager.removeEventListener(a._dom.header_close,"click",a._listener.close),a.closeDialog()},a._appendImageUrlParams=function(b){f.isObject(a._config.origin_params.image_urls)&&Object.keys(a._config.origin_params.image_urls).forEach(function(c){var d="image_url_"+c;b[d]=a._config.origin_params.image_urls[c]})},a._handler.submit=f.createClickOnceHandler(function(){a._modules.event_manager.removeEventListener(a._dom.submit_button,"click",a._handler.submit.listener),a._sendingSubmitButton();var b={};a._appendImageUrlParams(b),b.message=a._dom.message.firstChild.value,b.app_id=a._config.app_id,b.twitter_share=a._state.twitter_share,b.callback_url=a._config.origin_params.callback_url||null,a._config.origin_params.snapid&&(b.snapid=a._config.origin_params.snapid);try{a._modules.api.process("share_commit",b,function(a){p.dispatchEvent("share_commited",a)})}catch(c){a._resetSubmitButton(a._handler.submit.reset)}}),a._listener.twitter=function(){a._dom.container.find(".greepf-share-twitter").isNotEmpty()?a.Ext.Twitter.disable():a.Ext.auth(a.Ext.Twitter.auth_default_options)},a._listener.change=function(){a._util.setShareNum()},a._dom={},a._sendingSubmitButton=function(){a._dom.submit_button.addClass("greepf-share-submit-button-noneselected"),a._dom.submit_button.text(p.config.msg.share.sending_submit_button)},a._resetSubmitButton=function(b){a._dom.submit_button.removeClass("greepf-share-submit-button-noneselected"),a._dom.submit_button.text(p.config.msg.share.submit_button),b()},a.bindImage=function(){var b=null;q("#greepf_share_image_240");if(f.isObject(a._config.origin_params.image_urls)&&(b=a._config.origin_params.image_urls[240]||null),b){var c=q("<div>");c.style("text-align","left");var d=q("<img>");d.setAttribute("id","greepf_share_image_240"),d.setAttribute("src",b),d.style("width","100px"),c.append(d),a._dom.container.append(c)}},a.bindInviteDescription=function(b){if(b.is_append){var c=b.description,d=!0,e=18e5;a._modules.api.process("share_facebook_description",{app_id:a._config.app_id,message:c},function(b){if("ok"===b.state){var c=q("<div>");c.setAttribute("class","greepf-share-invite-desc"),c.html(f.util.replaceMessage(a._config.invite_desc_html,{custom:{icon_url:b.icon_url,title:b.description,body:b.name}})),a._dom.container.append(c)}},d,e)}},a._util={},a._util.setDom=function(){a._dom={container:q(".greepf-share-container"),header_close:q(".greepf-share-header-close"),submit_button:q(".greepf-share-submit-button"),description:q(".greepf-share-description"),message:q(".greepf-share-txt-area"),share_num:q(".greepf-share-num"),ext_facebook:q("#greepf-share-facebook"),ext_twitter:q("#greepf-share-twitter")}},a._util.setShareNum=function(){var b=a._config.share_num,c=a._dom.message.firstChild.value.length;a._dom.share_num.text(b-c)},a._util.setDefault=function(){var b=a._config.origin_params.message;a._dom.message.firstChild.value=b||"",a._resetSubmitButton(a._handler.submit.reset),a.Ext.Twitter.disable(),a._util.setShareNum(),a.Ext.confirm(a.Ext.Twitter.confirm_default_options)},p.addModule("share",a)}(),function(){var a=p.getModule("share");a.Extend=a.Extend||{},a.Extend.External=a.Extend.External||{};var b=a.Extend.External;b.editParams={_common:function(a){return a.app_id=p.config.app_id,a.placeholder_text=p.config.msg.share[a.service+"_placeholder"],a},facebook:function(a){return a.service="facebook",a.auth_api_name="share_facebook_auth",a.commit_api_name="share_facebook_commit",a.description=p.config.msg.share.facebook_description,a=this._common(a)},facebook_description:function(a){return a=this.facebook(a),a.description=p.config.msg.share.facebook_invite_description,a.commit_api_name="invite_facebook_commit",a},twitter:function(a){return a.service="twitter",a.auth_api_name="share_twitter_auth",a.commit_api_name="share_twitter_commit",a.description=p.config.msg.share.twitter_description,a=this._common(a)}},b._openDialogHandler=f.createExecuteOnceHandler(function(c,d){if(c.on){var e=c.on;c.append_invite_description&&(e=c.on+"_description"),c=b.editParams[e](c)}a.Ext.auth({api_name:c.auth_api_name,success:function(e){var g=p.config.msg,h="invite"===c.type?g.invite.header_title:g.share.header_title;c.append_invite_description&&(h=g.invite.header_title),f.util.prepareOpenDialog({prefix:"greepf-share-",content_html:a._config.main_html,title:h,open_handler:b._openDialogHandler,parent_dialog_container:d.dialog_container,parent_close_func:d.close_func}),b.display(c)},failure:function(a){b.error()}})}),b.openDialog=b._openDialogHandler.execute,b.display=function(c){a._config.origin_params=f.copy(c),a._util.setDom(),a._dom.ext_twitter.hide(),a._modules.dialog.show(),a._dom.container.show(),a._dom.description.text(c.description),a._dom.message.firstChild.value=a._config.origin_params.message||"",a._dom.description.show(),a.bindImage(),a.bindInviteDescription({is_append:c.append_invite_description,description:c.invite_description}),a._config.origin_params.placeholder_text&&a._dom.message.setAttribute("placeholder",a._config.origin_params.placeholder_text),a._resetSubmitButton(b._handler.submit.reset),a._modules.event_manager.removeaddEventListener(a._dom.message,"input",a._listener.change),a._modules.event_manager.removeaddEventListener(a._dom.submit_button,"click",b._handler.submit.listener)},b.error=function(){},b._handler={},b._handler.submit=f.createClickOnceHandler(function(){a._sendingSubmitButton(),a._config.origin_params.url?b._commit({app_id:a._config.app_id,body:a._dom.message.firstChild.value,url:a._config.origin_params.url,type:a._config.origin_params.type}):"invite"===a._config.origin_params.type?f.util.getExternalConfig(function(c){b._commit({app_id:a._config.app_id,body:a._dom.message.firstChild.value,url:c[a._config.origin_params.service].invite_url,type:a._config.origin_params.type})}):a._config.origin_params.append_invite_description?f.util.getExternalConfig(function(c){b._commit({app_id:a._config.app_id,body:a._dom.message.firstChild.value,message:a._config.origin_params.invite_description})}):f.util.getExternalConfig(function(c){var d={};a._appendImageUrlParams(d),d.app_id=a._config.app_id,d.body=a._dom.message.firstChild.value,d.url=c[a._config.origin_params.service].share_url,b._commit(d)})}),b._commit=function(c){try{a._modules.api.process(a._config.origin_params.commit_api_name,c,function(a){p.dispatchEvent("share_commited",a)})}catch(d){a._resetSubmitButton(b._handler.submit.reset)}},b.closeDialog=function(){b._openDialogHandler.reset()}}(),function(){var a={};a._config={app_id:null,enabled_external_invite:!1,regex:{convert_item:/{[_a-z]*}/gi},origin_params:null},a._config.main_html=String()+" <div class='greepf-req-menu'> <ul class='greepf-req-menu-edge'> <li class='greepf-req-menu-all'><span>{$request.menu_all}</span></li> <li class='greepf-req-menu-joined'><span>{$request.menu_joined}</span></li> </ul> </div><div class='greepf-req-exception'><div class='greepf-req-exception-message'><div class='greepf-req-exception-message-text'></div></div></div> <div class='greepf-req-users'> </div><div class='greepf-req-loading'><div class='greepf-req-loading-icon'></div></div> <div class='greepf-req-more'><span>{$request.more}</span></div> <div class='greepf-req-message'> <div class='greepf-req-message-box'> <p class='greepf-req-message-box-title'></p> <p class='greepf-req-message-box-body'></p> </div> </div> <div class='greepf-req-submit'> <button class='greepf-req-submit-button'>{$request.submit_button_default}</button> </div>",a._config.user_html=String()+"<div class='greepf-req-users-item' user_id='{user_id}' row_num='{row_num}'><div class='greepf-req-users-item-icon' user_id='{user_id}' style='{icon}' row_num='{row_num}'></div><div class='greepf-req-users-item-name' row_num='{row_num}'>{name}</div><div class='greepf-req-users-item-check' row_num='{row_num}'><div class='greepf-req-users-item-check-box' row_num='{row_num}'></div></div></div>",a._config.specified_user_html=String()+"<div class='greepf-req-users-item' user_id='{user_id}' row_num='{row_num}'><div class='greepf-req-users-item-icon' style='{icon}' row_num='{row_num}'></div><div class='greepf-req-users-item-name' row_num='{row_num}'>{name}</div></div>",a._modules={dailog:null,event_manager:null,api:null,external_invite:null},a._submodules={},a._dom={},a._state={dialog_open_time:null,user_list_type:null,user_list_index:0,message_title:null,message_body:null,to_user_ids:null},a._util={},a._util.setDom=function(){a._dom={container:q(".greepf-req-container"),header:q("#greepf-req-header"),header_title:q("#greepf-req-header-title"),header_close:q("#greepf-req-header-close"),menu:q(".greepf-req-menu"),menu_all:q(".greepf-req-menu-all"),menu_joined:q(".greepf-req-menu-joined"),exception:q(".greepf-req-exception"),exception_message:q(".greepf-req-exception-message-text"),user_list:q(".greepf-req-users"),loading:q(".greepf-req-loading"),more:q(".greepf-req-more"),message:q(".greepf-req-message"),message_title:q(".greepf-req-message-box-title"),message_body:q(".greepf-req-message-box-body"),submit_button:q(".greepf-req-submit-button")}},a._util.getUserHtmlTpl=function(){return"specified"===a._state.user_list_type?a._config.specified_user_html:a._config.user_html},a._util.userListToHtml=function(b){var c=[];return b.forEach(function(b){c.push(a._util.userDataToHtml(a._state.user_list_index,b)),a._state.user_list_index=a._state.user_list_index+1}),c.join("")},a._util.userDataToHtml=function(b,c){return a._util.getUserHtmlTpl().replace(a._config.regex.convert_item,function(a){return"{user_id}"==a?c.user_id:"{name}"==a?f.htmlentities(c.nick_name):"{icon}"==a?c.thumbnail_url?'background:url("'+c.thumbnail_url+'")':"":"{row_num}"==a?b:void 0})},a._util.bindThumbnail=function(a){var b,c,d,e;c={},a.forEach(function(a){c[a.user_id]=a.url}),b=q(".greepf-req-users-item-icon"),b.each(function(a){d=a.getAttribute("user_id"),e=c[d],e&&a.style("background",'url("'+e+'")')})},a._listener={},a._listener.toggleUserList=function(b){var c,d;b.target.attributes.row_num&&(d=b.target.attributes.row_num.value,c=a._dom.user_list.selectChild("row_num",d),c.toggleClass("greepf-req-users-item-selected"),c.find(".greepf-req-users-item-check-box").toggleClass("greepf-req-users-item-check-box-checked"),a._dialog.refreshSubmitButton())},a._listener.more=function(){a._dialog.showLoading(),a._dialog.hideMore(),a._api.getUserList({list_type:a._state.user_list_type,limit:15,offset:a._state.user_list_index},function(b){a._dialog.hideLoading(),b&&b.list&&b.list.length>0&&(a._dialog.appendUserList(b.list,a._util.getUserHtmlTpl()),b.paging.next?a._dialog.showMore():a._dialog.hideMore())})},a._listener.selectedAllMenu=function(){var b;a._state.user_list_type="all",a._state.user_list_index=0,b=a._submodules[a._state.user_list_type],b.showUserList({list_type:a._state.user_list_type})},a._listener.selectedJoinedMenu=function(){var b;a._state.user_list_type="joined",a._state.user_list_index=0,b=a._submodules[a._state.user_list_type],b.showUserList({list_type:a._state.user_list_type})},a._submit_handler=f.createClickOnceHandler(function(){var b,c=[];return b=q("specified"===a._state.user_list_type?".greepf-req-users-item":".greepf-req-users-item-selected"),0===b.length()?void a._submit_handler.reset():(a._dom.submit_button.addClass("greepf-req-submit-button-noneselected"),a._dom.submit_button.text(p.config.msg.request.sending_submit_button),b.each(function(a){c.push(a.getAttribute("user_id"))}),a._modules.api.process("commit_request",{app_id:a._config.app_id,title:a._state.message_title,body:a._state.message_body,list_type:a._state.user_list_type,to_user_ids:c,expire_time:a._config.origin_params.expire_time,callback_url:a._config.origin_params.callbackurl,redirect_url:a._config.origin_params.redirect_url,touch_url:a._config.origin_params.touch_url,mobile_url:a._config.origin_params.mobile_url,device_custom_urls:a._config.origin_params.device_custom_urls,social_graph_name:a._config.origin_params.social_graph_name,attrs:a._config.origin_params.attrs,notification_mail:a._config.origin_params.notification_mail,awakening:a._config.origin_params.awakening,touch_image:a._config.origin_params.touch_image,image_url:a._config.origin_params.image_url},function(a){p.dispatchEvent("request_commited",a)}),void("specified"==a._state.user_list_type?a._api.removeUserListCache({list_type:"specified",to_user_ids:a._state.to_user_ids,limit:15,offset:0}):a.removeFriendsCache()))}),a._dialog={},a._dialog.showHeader=function(b){b?a._dom.header_title.text(b):a._dom.header_title.text(p.config.msg.request.header_title),a._dom.header.show()},a._dialog.hideHeader=function(){a._dom.header.hide()},a._dialog.showTabMenu=function(b,c){b&&a._dom.menu_all.text(b),c&&a._dom.menu_joined.text(c),a._dialog.changeTabMenu(),a._dom.menu.show()},a._dialog.hideTabMenu=function(){a._dom.menu.hide()},a._dialog.changeTabMenu=function(){"all"===a._state.user_list_type?(a._dom.menu_all.addClass("greepf-req-menu-select"),a._dom.menu_joined.removeClass("greepf-req-menu-select"),a._modules.event_manager.removeaddEventListener(a._dom.menu_joined,"click",a._listener.selectedJoinedMenu),a._modules.event_manager.removeEventListener(a._dom.menu_all,"click",a._listener.selectedAllMenu)):(a._dom.menu_joined.addClass("greepf-req-menu-select"),a._dom.menu_all.removeClass("greepf-req-menu-select"),a._modules.event_manager.removeaddEventListener(a._dom.menu_all,"click",a._listener.selectedAllMenu),a._modules.event_manager.removeEventListener(a._dom.menu_joined,"click",a._listener.selectedJoinedMenu))},a._dialog.showException=function(b){a._dom.exception_message.text(b),a._dom.exception.show()},a._dialog.hideException=function(){a._dom.exception.hide()},a._dialog.showUserList=function(b){if(!b||0===b.length)return!1;var c=a._util.userListToHtml(b);return a._dom.user_list.html(c),a._dom.user_list.show(),!0},a._dialog.addToggleEventToUserList=function(){a._modules.event_manager.removeaddEventListener(a._dom.user_list,"click",a._listener.toggleUserList)},a._dialog.removeToggleEventOfUserList=function(){a._modules.event_manager.removeEventListener(a._dom.user_list,"click",a._listener.toggleUserList)},a._dialog.hideUserList=function(){a._dom.user_list.hide()},a._dialog.appendUserList=function(b){if(!b||0===b.length)return!1;var c,d;c=a._util.userListToHtml(b),d=a._dom.user_list.html(),a._dom.user_list.html(d+c)},a._dialog.appendThumbnailToUserList=function(b){a._api.getThumbnail(b,function(b){a._util.bindThumbnail(b.urls)})},a._dialog.showLoading=function(){a._dom.loading.show()},a._dialog.hideLoading=function(){a._dom.loading.hide()},a._dialog.showMore=function(){a._modules.event_manager.removeaddEventListener(a._dom.more,"click",a._listener.more),a._dom.more.show()},a._dialog.hideMore=function(){a._dom.more.hide()},a._dialog.showMessagebox=function(b,c){a._dom.message_title.text(b),a._dom.message_body.text(c),a._dom.message.show()},a._dialog.hideMessagebox=function(){a._dom.message.hide()},a._dialog.showSubmitButton=function(b){b&&a._dom.submit_button.text(b),a._dom.submit_button.removeClass("greepf-req-submit-button-noneselected"),a._dom.submit_button.show(),a._modules.event_manager.removeaddEventListener(a._dom.submit_button,"click",a._submit_handler.listener)},a._dialog.hideSubmitButton=function(){a._dom.submit_button.hide()},a._dialog.refreshSubmitButton=function(){var b=document.querySelectorAll(".greepf-req-users-item-selected").length;b>0?(a._modules.event_manager.removeaddEventListener(a._dom.submit_button,"click",a._submit_handler.listener),a._dom.submit_button.text(p.config.msg.request.submit_button.replace(a._config.regex.convert_item,b)),a._dom.submit_button.removeClass("greepf-req-submit-button-noneselected")):(a._modules.event_manager.removeEventListener(a._dom.submit_button,"click",a._listener.submit),a._dom.submit_button.text(p.config.msg.request.noneselected_submit_button),a._dom.submit_button.addClass("greepf-req-submit-button-noneselected"))},a._dialog.selectAllUser=function(){var a,b;a=q(".greepf-req-users-item"),a.each(function(a){a.addClass("greepf-req-users-item-selected")}),b=q(".greepf-req-users-item-check-box"),b.each(function(a){a.addClass("greepf-req-users-item-check-box-checked")})},a._dialog.showExternalInvite=function(){a._config.enabled_external_invite&&(a._dom.user_list.html(""),a._modules.external_invite.bindContent({container:a._dom.container,content:a._dom.user_list,dialog_close:a.closeDialog}),a._dom.user_list.show())},a._api={},a._api.getUserList=function(b,c,d,e){a._modules.api.process("get_request_user_list",{app_id:a._config.app_id,list_type:b.list_type,to_user_ids:b.to_user_ids,limit:b.limit,offset:b.offset},function(a){c(a)},d,e)},a._api.removeUserListCache=function(b){a._modules.api.removeCache("get_request_user_list",{app_id:a._config.app_id,list_type:b.list_type,to_user_ids:b.to_user_ids,limit:b.limit,offset:b.offset})},a._api.getThumbnail=function(b,c){var d=[];b.forEach(function(a){d.push([a.user_id,"normal"])}),a._modules.api.process("get_thumbnail",{app_id:a._config.app_id,user_list:d},c)},a.addSubModule=function(b,c){a._submodules[b]=c},a.init=function(){a._modules.dialog=p.getModule("dialog"),a._modules.event_manager=p.getModule("event_manager"),a._modules.api=p.getModule("server_api"),a._modules.external_invite=p.getModule("external_invite"),a._config.app_id=p.config.app_id,a._config.enabled_external_invite=a._modules.external_invite?!0:!1,Object.keys(a._submodules).forEach(function(b){a._submodules[b].init({api_module:a._api,dialog_module:a._dialog,state:a._state})})},a._openDialogHandler=f.createExecuteOnceHandler(function(b,c){if(!p.config.msg)return void a._openDialogHandler.reset();f.util.prepareOpenDialog({prefix:"greepf-req-",content_html:a._config.main_html,title:p.config.msg.request.header_title,open_handler:a._openDialogHandler,parent_dialog_container:c.dialog_container,parent_close_func:c.close_func});var d;a._util.setDom(),a._config.origin_params=f.copy(b),a._state.user_list_index=0,a._state.message_title=b.title,a._state.message_body=b.body,a._state.to_user_ids=b.to_user_ids,a._state.user_list_type=b.list_type,a._submit_handler.reset(),d=a._submodules[a._state.user_list_type],a._modules.dialog.show(),d.openDialog(b),a._dom.container.show()}),a.openDialog=a._openDialogHandler.execute,a.closeDialog=function(){a._modules.event_manager.dispatchEvent("greepf-req-close-event")},a.cacheFriends=function(){a._cacheFriends(!0,864e5)},a._cacheFriends=function(b,c){k.isAvailable()&&(a._api.getUserList({list_type:"all",limit:15,offset:0},function(a){},b,c),a._api.getUserList({list_type:"joined",limit:15,offset:0},function(a){},b,c))},a.removeFriendsCache=function(){k.isAvailable()&&(a._api.removeUserListCache({list_type:"all",limit:15,offset:0}),a._api.removeUserListCache({list_type:"joined",limit:15,offset:0}))},p.addModule("request",a)}(),function(){var a=p.getModule("request"),b=function(a){this.config={list_type:a,dialog:null,api:null,message:null,state:null,data_cache_time:864e5}};b.prototype.init=function(a){this.config.api=a.api_module,this.config.dialog=a.dialog_module,this.config.state=a.state},b.prototype.openDialog=function(a){var b=this.config.dialog,c=this.config;b.hideException(),b.hideUserList(),
b.hideTabMenu(),b.hideMore(),b.hideSubmitButton(),b.showHeader(),b.showLoading(),b.showMessagebox(a.title,a.body),c.api.getUserList({list_type:c.list_type,limit:15,offset:0},function(a){return 200!==a.status.code?(b.hideLoading(),b.hideMessagebox(),void b.showException(p.config.msg.request.error)):void(a.list_type==c.state.user_list_type&&(a&&a.list&&a.list.length>0?(b.hideLoading(),b.showTabMenu(),b.showUserList(a.list),b.selectAllUser(),b.addToggleEventToUserList(),a.paging.next?b.showMore():b.hideMore(),b.refreshSubmitButton(),b.showSubmitButton(),a.is_used_cache&&b.appendThumbnailToUserList(a.list)):(b.hideLoading(),b.hideMessagebox(),b.showException(p.config.msg.request.user_not_found),b.showExternalInvite())))},!0,c.data_cache_time)},b.prototype.showUserList=function(a){var b=this.config.dialog,c=this.config;b.hideException(),b.hideUserList(),b.hideMore(),b.hideSubmitButton(),b.showTabMenu(),b.showLoading(),c.api.getUserList({list_type:a.list_type,limit:15,offset:0},function(a){return 200!==a.status.code?(b.hideLoading(),b.hideMessagebox(),void b.showException(p.config.msg.request.error)):void(a.list_type==c.state.user_list_type&&(a&&a.list&&a.list.length>0?(b.hideLoading(),b.showUserList(a.list),b.selectAllUser(),b.addToggleEventToUserList(),a.paging.next?b.showMore():b.hideMore(),b.refreshSubmitButton(),b.showSubmitButton(),a.is_used_cache&&b.appendThumbnailToUserList(a.list)):(b.hideLoading(),b.hideMessagebox(),b.showException(p.config.msg.request.user_not_found),b.showExternalInvite())))},!0,c.data_cache_time)},a.addSubModule("all",new b("all")),a.addSubModule("joined",new b("joined"))}(),function(){var a=p.getModule("request");Specified={},Specified.config={dialog:null,api:null,message:null,state:null,data_cache_time:3e5},Specified.init=function(a){Specified.config.api=a.api_module,Specified.config.dialog=a.dialog_module,Specified.config.state=a.state},Specified.openDialog=function(a){Specified.config.dialog.hideException(),Specified.config.dialog.hideUserList(),Specified.config.dialog.hideTabMenu(),Specified.config.dialog.hideMore(),Specified.config.dialog.hideSubmitButton(),Specified.config.dialog.showHeader(),Specified.config.dialog.showLoading(),Specified.config.dialog.showMessagebox(a.title,a.body),Specified.config.api.getUserList({list_type:a.list_type,to_user_ids:a.to_user_ids,limit:15,offset:0},function(a){return 200!==a.status.code?(Specified.config.dialog.hideLoading(),Specified.config.dialog.hideMessagebox(),void Specified.config.dialog.showException(p.config.msg.request.error)):void(a.list_type==Specified.config.state.user_list_type&&(Specified.config.dialog.hideLoading(),a&&a.list&&a.list.length>0?(Specified.config.dialog.showUserList(a.list),Specified.config.dialog.removeToggleEventOfUserList(),Specified.config.dialog.showSubmitButton(p.config.msg.request.specified_submit_button)):(Specified.config.dialog.hideMessagebox(),Specified.config.dialog.showException(p.config.msg.request.user_not_found),Specified.config.dialog.showExternalInvite())))})},Specified.showUserList=function(){},a.addSubModule("specified",Specified)}(),function(){var a={};a._config={app_id:null,enabled_external_invite:!1,regex:{convert_item:/{[_a-z]*}/gi},origin_params:null,cross_app_setting:null,sns:{name:"SNS",class_name:"greepf-invite-app-selector-sns"},limit:16,submit:{max_num:48},view:{cols:4},user_list_short_cache_time:3e5},a._config.main_html=String()+"<div class='greepf-invite-unit'><div class='greepf-invite-hl'>{$invite.invite_hl}</div><div class='greepf-invite-cst'><div class='greepf-invite-btn-orange greepf-invite-btn-top'>{$invite.default_submit_button}</div><div class='greepf-invite-select-all'>{$invite.select_clear}</div></div><div class='greepf-invite-cst-gray greepf-invite-app-selector-wrap'><div class='greepf-invite-flex greepf-invite-app-selector'></div></div><div class='greepf-invite-cst greepf-invite-users'></div><div class='greepf-invite-loading'><div class='greepf-invite-loading-icon'></div></div><div class='greepf-invite-more greepf-invite-cst'>{$invite.more}<div class='greepf-invite-arw-b'></div></div><div class='greepf-invite-exception'><div class='greepf-invite-exception-message'><div class='greepf-invite-exception-message-text'></div></div></div><div class='greepf-invite-cst greepf-invite-btn'><div class='greepf-invite-message'><div class='greepf-invite-message-box-title'></div><div class='greepf-invite-message-box-body'></div></div><div class='greepf-invite-btn-orange greepf-invite-btn-bottom'>{$invite.default_submit_button}</div></div></div><div class='greepf-invite-external-unit'><div class='greepf-invite-external-item'><div class='greepf-invite-external-title'><div class='greepf-invite-external-title-text'>{$invite.external_invite_title}</div></div><div class='greepf-invite-external-icon'><div class='greepf-invite-external-icon-image greepf-invite-external-icon-image-line'></div></div><div class='greepf-invite-external-arrow'><div class='greepf-invite-external-arrow-image'></div></div></div></div>",a._config.all_user_html=String()+"<div class='greepf-invite-itm-center greepf-invite-user' user_id='{user_id}' row_num='{row_num}'><div class='greepf-invite-icon' style='{icon}' user_id='{user_id}' row_num='{row_num}'><div class='greepf-invite-check-box-user greepf-invite-check' user_id='{user_id}' invitee_token='{invitee_token}' row_num='{row_num}'></div></div><div class='greepf-invite-desc' user_id='{user_id}' row_num='{row_num}'>{name}</div></div>",a._config.all_user_header_html=String()+"<div class='greepf-invite-flex' col_num='{col_num}'>",a._config.all_user_footer_html=String()+"</div>",a._config.all_user_void_html=String()+"<div class='greepf-invite-itm-center greepf-invite-user'></div>",a._config.app_merged_html=String()+"<div class='greepf-invite-itm-center'><div class='greepf-invite-icon-mini greepf-invite-app-selector-merged'><div class='greepf-invite-check-box-app greepf-invite-check'></div></div><div class='greepf-invite-desc'>{$invite.all_app}</div></div>",a._config.app_html=String()+"<div class='greepf-invite-itm-center' app_id='{app_id}'><div class='greepf-invite-icon-mini{class_name}' style='{icon}' app_id='{app_id}'><div class='greepf-invite-check-box-app'></div></div><div class='greepf-invite-desc' app_id='{app_id}'>{name}</div></div>",a._config.app_selector_opener_html=String()+"<div class='greepf-invite-itm-right'><div class='greepf-invite-lnk greepf-invite-app-selector-opener'>{$invite.app_setlector_opener}<div class='greepf-invite-arw-blue-b'></div></div></div>",a._modules={dialog:null,event_manager:null,api:null,external_invite:null},a._submodules={},a._dom={},a._state={dialog_open_time:null,user_list_type:null,user_list_index:0,message_title:null,message_body:null,to_user_ids:null,selected_app_id:null,select_all:"clear"},a._util={},a._util.setDom=function(){a._dom={container:q(".greepf-invite-container"),header:q("#greepf-invite-header"),header_title:q("#greepf-invite-header-title"),header_close:q("#greepf-invite-header-close"),exception:q(".greepf-invite-exception"),exception_message:q(".greepf-invite-exception-message-text"),select_all:q(".greepf-invite-select-all"),user_list:q(".greepf-invite-users"),loading:q(".greepf-invite-loading"),more:q(".greepf-invite-more"),message:q(".greepf-invite-message"),message_title:q(".greepf-invite-message-box-title"),message_body:q(".greepf-invite-message-box-body"),submit_bottom_wrap:q(".greepf-invite-btn"),submit_button_top:q(".greepf-invite-btn-top"),submit_button_bottom:q(".greepf-invite-btn-bottom"),app_selector_wrap:q(".greepf-invite-app-selector-wrap"),app_selector:q(".greepf-invite-app-selector"),app_selector_opener:q(".greepf-invite-app-selector-opener"),external_invite:q(".greepf-invite-external-unit"),external_invite_text:q(".greepf-invite-external-title-text"),external_invite_icon:q(".greepf-invite-external-icon-image")}},a._util.getUserHtmlTpl=function(){return a._config.all_user_html},a._util.userListToHtml=function(b){var c=[],d=a._config.view.cols;if(b.forEach(function(b){a._state.user_list_index%d===0&&c.push(a._config.all_user_header_html.replace(a._config.regex.convert_item,function(b){return"{col_num}"==b?parseInt(a._state.user_list_index/d):void 0})),c.push(a._util.userDataToHtml(a._state.user_list_index,b)),a._state.user_list_index%d===3&&c.push(a._config.all_user_footer_html),a._state.user_list_index=a._state.user_list_index+1}),a._state.user_list_index%d>0){for(var e=a._state.user_list_index%d;d>e;e++)c.push(a._config.all_user_void_html);c.push(a._config.all_user_footer_html)}return c.join("")},a._util.userDataToHtml=function(b,c){return a._util.getUserHtmlTpl().replace(a._config.regex.convert_item,function(d){return"{user_id}"==d?c.user_id:"{invitee_token}"==d?c.invitee_token:"{name}"==d?f.htmlentities(c.nick_name):"{icon}"==d?c.thumbnail_url?'background:url("'+c.thumbnail_url+'")':"":"{row_num}"==d?b:"{col_num}"==d?parseInt(b/a._config.view.cols):void 0})},a._util.bindThumbnail=function(a){var b,c,d,e;c={},a.forEach(function(a){c[a.user_id]=a.url}),b=q(".greepf-invite-icon"),b.each(function(a){d=a.getAttribute("user_id"),e=c[d],e&&a.style("background",'url("'+e+'")')})},a._util.adjustSelectUserCount=function(){var b=a._dom.user_list.find(".greepf-invite-check");if(a._config.submit.max_num<b.length()){var c=1,d=!1;b.each(function(b){a._config.submit.max_num<c++&&(b.removeClass("greepf-invite-check"),d=!0)}),d&&a._dialog.displayMaxSelectError(),a._dialog.refreshSubmitButton()}},a._util.removeUserListCache=function(){a._modules.api.removeCacheByApiNameOnly("get_invite_user_list")},a._listener={},a._listener.toggleSelectAll=function(b){"select"===a._state.select_all?(a._dialog.selectAllUser(),a._dom.select_all.text(p.config.msg.invite.select_clear),a._state.select_all="clear"):(a._dialog.clearSelectAllUser(),a._dom.select_all.text(p.config.msg.invite.select_all),a._state.select_all="select")},a._listener.toggleApp=function(b){var c=b.target.attributes.app_id?b.target.attributes.app_id.value:null;a._state.selected_app_id=c,q(".greepf-invite-check").removeClass("greepf-invite-check");var d,e={list_type:a._state.user_list_type,limit:a._config.limit,offset:0};c?(d=q(".greepf-invite-app-selector").selectChild("app_id",c),e.select_app_id=c):d=q(".greepf-invite-app-selector-merged"),d.find(".greepf-invite-check-box-app").toggleClass("greepf-invite-check"),a._dialog.hideSubmit(),a._dialog.hideSelectAllButton(),a._dialog.clearUserList(),a._dialog.showLoading();var f=!0;a._api.getUserList(e,function(b){a._dialog.hideLoading(),"gree"==a._state.disp_type&&a._state.selected_app_id==c&&(b&&b.list&&b.list.length>0?(a._dialog.showUserList(b.list),b.paging.next&&a._dialog.showMore(),a._dialog.selectAllUser(),a._dialog.showSelectAllButton()):(a._dialog.hideSubmit(),a._dialog.hideSelectAllButton(),a._dialog.showException(p.config.msg.invite.user_not_found)))},f,a._config.user_list_short_cache_time)},a._listener.toggleUser=function(b){function c(){var a=!1;return g.each(function(b){return b.getAttribute("row_num")==e?(a=!0,!1):void 0}),a}if(b.target.attributes.row_num){var d,e,f,g;e=b.target.attributes.row_num.value,g=a._dom.user_list.find(".greepf-invite-check"),g.length()>=a._config.submit.max_num&&!c()||(f=""+parseInt(e/a._config.view.cols),d=a._dom.user_list.selectChild("col_num",f).selectChild("row_num",e),d.find(".greepf-invite-check-box-user").toggleClass("greepf-invite-check"),a._dialog.refreshSubmitButton())}},a._listener.more=function(){a._dialog.disableSubmit(p.config.msg.invite.searching_submit_button),a._dialog.hideMore(),a._dialog.showLoading(),a._api.getUserList({list_type:a._state.user_list_type,limit:a._config.limit,offset:a._state.user_list_index},function(b){a._dialog.hideLoading(),b&&b.list&&b.list.length>0&&(a._dialog.appendUserList(b.list,a._util.getUserHtmlTpl()),b.paging.next&&a._dialog.showMore()),a._dialog.refreshSubmitButton()})},a._listener.submit=function(){a._dialog.disableSubmit(p.config.msg.invite.sending_submit_button);var b,c,d,e;c=[],d=[],b=q(".greepf-invite-check"),b.each(function(a){e=a.getAttribute("user_id"),e&&(c.push(e),d.push(a.getAttribute("invitee_token")))}),a._modules.api.process("commit_invite",{app_id:a._config.app_id,body:a._state.message_body,list_type:a._state.user_list_type,to_user_ids:c,invitee_token_list:d,callback_url:a._config.origin_params.callbackurl,social_graph_name:a._config.origin_params.social_graph_name,view:a._config.origin_params.view},function(a){p.dispatchEvent("invite_commited",a)}),a._util.removeUserListCache()},a._listener.openExternalInvite=function(){a._modules.external_invite.openDialog({},{dialog_container:a._dom.container,close_func:a.closeDialog})},a._dialog={},a._dialog.showHeader=function(b){b?a._dom.header_title.text(b):a._dom.header_title.text(p.config.msg.invite.header_title),a._dom.header.show()},a._dialog.hideHeader=function(){a._dom.header.hide()},a._dialog.showTabMenu=function(){var b=a.getCrossAppSetting();if(null!=b){a._dom.app_selector_wrap.hide();var c=[];for(var d in b.cross_invitable_app_list)b.cross_invitable_app_list[d].id!=b.sns_application_id&&c.push(a._config.app_html.replace(a._config.regex.convert_item,function(a){return"{name}"==a?b.cross_invitable_app_list[d].name:"{app_id}"==a?b.cross_invitable_app_list[d].id:"{icon}"==a?b.cross_invitable_app_list[d].thumbnail_url?"background-image:url("+b.cross_invitable_app_list[d].thumbnail_url+")":"":"{class_name}"==a?"":void 0}));c.length<1||(c.unshift(a._config.app_html.replace(a._config.regex.convert_item,function(c){return"{name}"==c?a._config.sns.name:"{app_id}"==c?b.sns_application_id:"{icon}"==c?"":"{class_name}"==c?a._config.sns.class_name?" "+a._config.sns.class_name:"":void 0})),c.unshift(f.util.replaceMessage(a._config.app_merged_html)),a._dom.app_selector.html(c.join("")),a._dom.app_selector_wrap.show(),a._modules.event_manager.removeaddEventListener(a._dom.app_selector,"click",a._listener.toggleApp))}},a._dialog.hideTabMenu=function(){a._dom.app_selector_wrap.hide()},a._dialog.showException=function(b){a._dom.exception_message.text(b),a._dom.exception.show()},a._dialog.hideException=function(){a._dom.exception.hide()},a._dialog.showUserList=function(b){if(!b||0===b.length)return!1;var c=a._util.userListToHtml(b);return a._dom.user_list.html(c),a._dom.user_list.show(),!0},a._dialog.addToggleEventToUserList=function(){a._modules.event_manager.removeaddEventListener(a._dom.user_list,"click",a._listener.toggleUser)},a._dialog.removeToggleEventOfUserList=function(){a._modules.event_manager.removeEventListener(a._dom.user_list,"click",a._listener.toggleUser)},a._dialog.hideUserList=function(){a._dom.user_list.hide()},a._dialog.appendUserList=function(b){if(!b||0===b.length)return!1;var c,d;c=a._util.userListToHtml(b),d=a._dom.user_list.html(),a._dom.user_list.html(d+c),a._util.adjustSelectUserCount()},a._dialog.appendThumbnailToUserList=function(b){a._api.getThumbnail(b,function(b){a._util.bindThumbnail(b.urls)})},a._dialog.clearUserList=function(){a._dialog.hideMore(),a._dialog.hideException(),a._dialog.hideUserList(),a._state.user_list_index=0,a._dom.user_list.html("")},a._dialog.hideSubmit=function(){a._dom.submit_bottom_wrap.hide(),a._dom.submit_button_top.hide()},a._dialog.disableSubmit=function(b){a._modules.event_manager.removeEventListener(a._dom.submit_button_bottom.firstChild,"click",a._listener.submit),a._modules.event_manager.removeEventListener(a._dom.submit_button_top.firstChild,"click",a._listener.submit),a._dom.submit_button_top.text(b),a._dom.submit_button_bottom.text(b),a._dom.submit_button_top.addClass("greepf-invite-submit-button-noneselected"),a._dom.submit_button_bottom.addClass("greepf-invite-submit-button-noneselected")},a._dialog.showLoading=function(){a._dom.loading.show()},a._dialog.hideLoading=function(){a._dom.loading.hide()},a._dialog.showMore=function(){a._modules.event_manager.removeaddEventListener(a._dom.more,"click",a._listener.more),a._dom.more.show()},a._dialog.hideMore=function(){a._dom.more.hide()},a._dialog.showMessagebox=function(){(a._state.message_title||a._state.message_body)&&(a._dom.message_title.text(a._state.message_title),a._dom.message_body.text(a._state.message_body),a._dom.message.show())},a._dialog.hideMessagebox=function(){a._dom.message.hide()},a._dialog.showSelectAllButton=function(){a._state.select_all="select",a._listener.toggleSelectAll(),a._dom.select_all.show(),a._dom.select_all.bindEvent("click",a._listener.toggleSelectAll),a._dialog.showMessagebox()},a._dialog.hideSelectAllButton=function(){a._dom.select_all.hide(),a._dialog.hideMessagebox()},a._dialog.showSubmitButton=function(b){b&&(a._dom.submit_button_top.text(b),a._dom.submit_button_bottom.text(b)),a._dom.submit_button_top.removeClass("greepf-invite-submit-button-noneselected"),a._dom.submit_button_bottom.removeClass("greepf-invite-submit-button-noneselected"),a._dom.submit_button_top.show(),a._dom.submit_button_bottom.show(),a._modules.event_manager.removeaddEventListener(a._dom.submit_button_bottom,"click",a._listener.submit),a._modules.event_manager.removeaddEventListener(a._dom.submit_button_top,"click",a._listener.submit)},a._dialog.hideSubmitButton=function(){a._dom.submit_bottom_wrap.hide(),a._dom.submit_button_top.hide()},a._dialog.refreshSubmitButton=function(){var b,c=0;b=a._dom.user_list.find(".greepf-invite-check"),b.each(function(a){a.getAttribute("user_id")&&c++}),c>0?(a._modules.event_manager.removeaddEventListener(a._dom.submit_button_bottom,"click",a._listener.submit),a._modules.event_manager.removeaddEventListener(a._dom.submit_button_top,"click",a._listener.submit),a._dom.submit_button_top.text(p.config.msg.invite.submit_button.replace(a._config.regex.convert_item,c)),a._dom.submit_button_bottom.text(p.config.msg.invite.submit_button.replace(a._config.regex.convert_item,c)),a._dom.submit_button_top.removeClass("greepf-invite-submit-button-noneselected"),a._dom.submit_button_bottom.removeClass("greepf-invite-submit-button-noneselected")):a._dialog.disableSubmit(p.config.msg.invite.noneselected_submit_button),a._dom.submit_bottom_wrap.show(),a._dom.submit_button_top.show()},a._dialog.selectAllUser=function(){var b,c,d,e=1;c=a._dom.user_list.find(".greepf-invite-check"),b=q(".greepf-invite-check-box-user"),d=a._config.submit.max_num-c.length(),b.each(function(a){d>=e&&!a.containsClass("greepf-invite-check")&&(e++,a.addClass("greepf-invite-check"))}),a._dialog.refreshSubmitButton()},a._dialog.displayMaxSelectError=function(){var b=p.config.msg.invite.max_select_user_error.replace(a._config.regex.convert_item,a._config.submit.max_num);a._dialog.showException(b)},a._dialog.clearSelectAllUser=function(){var b;b=q(".greepf-invite-check-box-user"),b.each(function(a){a.removeClass("greepf-invite-check")}),a._dialog.refreshSubmitButton()},a._dialog.showGreeInvite=function(){a._state.disp_type="gree",a._state.user_list_index=0,submodule=a._submodules[a._state.user_list_type],submodule.openDialog(a._state.params),a._config.enabled_external_invite&&(a._dialog.showExternalInviteUnit(),a._dom.external_invite_icon.addClass("greepf-invite-external-icon-image-line"),a._dom.external_invite_icon.removeClass("greepf-invite-external-icon-image-gree"),a._dom.external_invite_text.text(p.config.msg.invite.external_invite_title)),f.util.scrollTop()},a._dialog.showExternalInviteUnit=function(){a._dom.external_invite.show(),a._dom.external_invite.bindEvent("click",a._listener.openExternalInvite)},a._dialog.hideExternalInviteUnit=function(){a._dom.external_invite.hide()},a._api={},a._api.getUserList=function(b,c,d,e){var f={app_id:a._config.app_id,list_type:b.list_type,to_user_ids:b.to_user_ids,limit:b.limit,offset:b.offset};b.append_app_setting&&(f.append_app_setting=b.append_app_setting),b.select_app_id&&(f.select_app_id=b.select_app_id),a._modules.api.process("get_invite_user_list",f,function(a){c(a)},d,e,["append_app_setting"])},a._api.getThumbnail=function(b,c){var d=[];b.forEach(function(a){d.push([a.user_id,"normal"])}),a._modules.api.process("get_thumbnail",{app_id:a._config.app_id,user_list:d},c)},a.addSubModule=function(b,c){a._submodules[b]=c},a.init=function(b){a._modules.dialog=p.getModule("dialog"),a._modules.event_manager=p.getModule("event_manager"),a._modules.api=p.getModule("server_api"),a._modules.external_invite=p.getModule("external_invite"),a._config.app_id=p.config.app_id,a._config.enabled_external_invite=a._modules.external_invite?!0:!1,Object.keys(a._submodules).forEach(function(b){a._submodules[b].init({api_module:a._api,dialog_module:a._dialog,state:a._state})})},a._openDialogHandler=f.createExecuteOnceHandler(function(b,c){f.util.prepareOpenDialog({prefix:"greepf-invite-",content_html:a._config.main_html,title:p.config.msg.invite.header_title,open_handler:a._openDialogHandler,parent_dialog_container:c.dialog_container,parent_close_func:c.close_func});a._util.setDom(),a._dialog.hideExternalInviteUnit(),a._dialog.hideSelectAllButton(),a._config.origin_params=f.copy(b),a._state.user_list_type=b.to_user_ids&&b.to_user_ids.length>0?"specified":"all",a._state.message_title=b.title,a._state.message_body=b.body,a._state.to_user_ids=b.to_user_ids,a._state.params=b,a._modules.dialog.show(),a._dialog.showGreeInvite(),a._dom.container.show(),p.dispatchEvent("invite_dialog_opened")}),a.openDialog=a._openDialogHandler.execute,a.closeDialog=function(){a._modules.event_manager.dispatchEvent("greepf-invite-close-event")},a.cacheFriends=function(){a._cacheFriends(!0,864e5)},a._cacheFriends=function(a,b){},a.setCrossAppSetting=function(b){a._config.cross_app_setting=b},a.getCrossAppSetting=function(){return a._config.cross_app_setting},a.removeFriendsCache=function(){k.isAvailable()&&a._util.removeUserListCache()},p.addModule("invite",a)}(),function(){var a=p.getModule("invite"),b=function(a){this.config={list_type:a,dialog:null,api:null,state:null,use_cache:!0,data_cache_time:3e5}};b.prototype.init=function(a){this.config.api=a.api_module,this.config.dialog=a.dialog_module,this.config.state=a.state},b.prototype.openDialog=function(b){var c=this.config.dialog,d=this.config;c.hideException(),c.hideUserList(),c.hideTabMenu(),c.hideMore(),c.hideSubmitButton(),c.showHeader(),c.showLoading();var b={list_type:d.list_type,limit:a._config.limit,offset:0};null==a.getCrossAppSetting()&&(b.append_app_setting=1),d.api.getUserList(b,function(b){c.hideLoading(),b.list_type==d.state.user_list_type&&"gree"==d.state.disp_type&&(b&&b.list&&b.list.length>0?(b.app_setting&&a.setCrossAppSetting(b.app_setting),c.showUserList(b.list),c.selectAllUser(),c.showSelectAllButton(),c.addToggleEventToUserList(),b.paging.next?c.showMore():c.hideMore(),c.refreshSubmitButton(),c.showSubmitButton(),b.is_used_cache&&c.appendThumbnailToUserList(b.list)):a._dialog.showException(p.config.msg.invite.user_not_found),c.showTabMenu())},d.use_cache,d.data_cache_time)},a.addSubModule("all",new b("all"))}(),function(){var a=p.getModule("invite"),b={};b.config={dialog:null,api:null,state:null,use_cache:!0,data_cache_time:3e5,limit:16},b.init=function(a){b.config.api=a.api_module,b.config.dialog=a.dialog_module,b.config.state=a.state},b.openDialog=function(a){var c=b.config.dialog;c.hideException(),c.hideUserList(),c.hideTabMenu(),c.hideMore(),c.hideSubmitButton(),c.showHeader(),c.showLoading(),b.config.api.getUserList({list_type:"specified",to_user_ids:a.to_user_ids,limit:b.config.limit,offset:0},function(a){c.hideLoading(),a.list_type==b.config.state.user_list_type&&"gree"==b.config.state.disp_type&&(a&&a.list&&a.list.length>0?(c.showUserList(a.list),c.selectAllUser(),c.showSelectAllButton(),c.addToggleEventToUserList(),c.showSubmitButton(p.config.msg.invite.default_submit_button)):b.config.dialog.showException(p.config.msg.invite.user_not_found))},b.config.use_cache,b.config.data_cache_time)},b.showUserList=function(){},a.addSubModule("specified",b)}(),function(){var a={};a._config={},a._modules={event_manager:null},a.init=function(b){a._modules.event_manager=p.getModule("event_manager")},a._changedUser=function(a){return a.is_updated_session&&p.config.user_id&&a.user_id&&p.config.user_id!=a.user_id},a.execute=function(b,c,d){if(a._changedUser({is_updated_session:d,user_id:b.user_id})){var e=p.getModule("server_api");e&&e.clearCache(),a._modules.event_manager.dispatchGlobalEvent("GreepfUserChanged",{new_user_id:b.user_id,old_user_id:p.config.user_id})}c&&p.dispatchEvent("friends_changed")},p.addModule("app_state_check",a)}(),function(){var a={};a._config={regex:{convert_item:/{[_a-z]*}/gi}},a._modules={dialog:null,event_manager:null,api:null,client_ui:null},a._dom={},a._config.main_html=String()+"<div class='greepf-ext-invite-content'></div>",a._config.item_html=String()+"<div class='greepf-ext-invite-item greepf-ext-invite-item-{item_name}'><div class='greepf-ext-invite-item-icon'><div class='greepf-ext-invite-item-icon-image greepf-ext-invite-item-icon-image-{item_name}'></div></div><div class='greepf-ext-invite-item-title'><div class='greepf-ext-invite-item-title-text'>{title}</div></div><div class='greepf-ext-invite-item-arrow'><div class='greepf-ext-invite-item-arrow-image'></div></div></div>",a._config.attention_html=String()+"<div class='greepf-ext-invite-item'><div class='greepf-ext-invite-attention' align='right' style='color:blue'>{$external_invite.attention_msg}</div>",a._config.announce_html=String()+"<div class='greepf-ext-invite-item'><h3 style='color:red;'>{$external_invite.announce_title}</h3><span style='color:red;'>{$external_invite.announce_msg}</span></div>",a._context={},a._context.items={line:{},sms:{},mail:{},twitter:{},facebook:{},qrcode:{}},a._state={dialog_close:null},a._listeners={},a._listeners.items={},a._listeners.items.line=function(){var b=a._modules.client_ui;b.process("line",{type:"invite"})},a._listeners.items.sms=function(){var b=a._modules.client_ui,c=a._context.items.sms;b.process("sms",{body:c.contents},function(a){"success"!=a.result&&alert(c.launch_error_msg)})},a._listeners.items.mail=function(){var b=a._modules.client_ui,c=a._context.items.mail;b.process("mail",{subject:c.subject,body:c.body},function(a){"success"!=a.result&&alert(c.launch_error_msg)})},a._listeners.items.twitter=function(){var b=a._modules.client_ui;b.process("invite_external_user",{service:"twitter"})},a._listeners.items.facebook=function(){var b=p.getModule("share");a._modules.event_manager.clearaddEventListener("share_commited",function(){b.closeDialog()}),b.Extend.External.openDialog({on:"facebook",append_invite_description:!0},{dialog_container:a._dom.container,close_func:a._state.dialog_close})},a._listeners.items.qrcode=function(){var b=a._context.items.qrcode.url,c=a._modules.client_ui;c.process("open",{view:"dashboard",url:b})},a._listeners.additional={},a._listeners.additional.attention=function(){p.getModule("attention").openDialog({page:"external_invite"},{dialog_container:a._dom.container,close_func:a._state.dialog_close})},a.init=function(){a._modules.event_manager=p.getModule("event_manager"),a._modules.api=p.getModule("server_api"),a._modules.client_ui=p.getModule("client_ui"),a._modules.dialog=p.getModule("dialog")},a._appendItems=function(b){var c,d;c=Object.keys(a._context.items),d="",d+=f.util.replaceMessage(a._config.announce_html),c.forEach(function(b){a._context.items[b].display&&(d+=a._config.item_html.replace(a._config.regex.convert_item,function(c){return"{title}"==c?a._context.items[b].title:"{item_name}"==c?b:void 0}))}),new Date<new Date("2015-07-01T10:00:00Z")&&(d+=f.util.replaceMessage(a._config.attention_html)),b.html(d)},a._setContentDomAndListener=function(){var b;b=Object.keys(a._context.items),b.forEach(function(b){a._context.items[b].display&&(a._dom[b]=q(".greepf-ext-invite-item-"+b),a._modules.event_manager.removeaddEventListener(a._dom[b],"click",a._listeners.items[b]))}),a._modules.event_manager.removeaddEventListener(q(".greepf-ext-invite-attention"),"click",a._listeners.additional.attention)},a._bindContent=function(){f.util.getExternalConfig(function(b){keys=Object.keys(a._context.items),keys.forEach(function(c){f.extend(a._context.items[c],b[c]),a._context.items[c].title=p.config.msg.external_invite[c]}),a._appendItems(a._dom.content),a._setContentDomAndListener()})},a._setDom=function(){a._dom.container=q("#greepf-ext-invite-container"),a._dom.header_title=q("#greepf-ext-invite-header-title"),a._dom.header_close=q("#greepf-ext-invite-header-close"),a._dom.content=q(".greepf-ext-invite-content")},a._openDialogHandler=f.createExecuteOnceHandler(function(b,c){f.util.prepareOpenDialog({prefix:"greepf-ext-invite-",content_html:a._config.main_html,title:p.config.msg.invite.header_title,open_handler:a._openDialogHandler,parent_dialog_container:c.dialog_container,parent_close_func:c.close_func}),a._setDom(),a._bindContent(),a._modules.dialog.show(),a._state.dialog_close=a.closeDialog}),a.openDialog=a._openDialogHandler.execute,a.bindContent=function(b){a._dom.container=b.container,a._dom.content=b.content,a._state.dialog_close=b.dialog_close,a._bindContent()},a.closeDialog=function(){a._modules.event_manager.dispatchEvent("greepf-ext-invite-close-event")},p.addModule("external_invite",a)}(),function(){var a={};a._config={replace_string:{from_user:/%from_user%/g,app_name:/%app_name%/g}},a.replace=function(b){if(!b)return b;var c=p.config.user_name,d=p.config.app_name;return c&&(b=b.replace(a._config.replace_string.from_user,c)),d&&(b=b.replace(a._config.replace_string.app_name,d)),b},p.addModule("placeholder",a)}(),function(){var a={};a._const={ALL_INFO:1,BANNER_ONLY:2,BANNER_CHUNK_SIZE:5},a._config={enabled:!1,app_id:null,use_iframe:0,basic_class:"_gpf-glContr",regex:{convert_item:/{[_a-z]*}/gi},tabfooter:[{key:"top",css:"top",gm:"top"},{key:"mygame",css:"game",gm:"myapp"},{key:"search",css:"search",gm:"apps"},{key:"chat",css:"chat",gm:null},{key:"recommend",css:"star",gm:"recommend"}],banner_query:{webview:"app_code=GWAAR000001&webview_footer=1&from_ggpfooter={app_id}",spweb:"app_code=GWAAR000002&from_ggpfooter=web_{app_id}"}},a._context={is_webview_app:null,ready_state:[],domains:[]},a._modules={api:null},a.init=function(b){a._config.enabled=p.config.enable_footer,a._config.app_id=p.config.app_id,a._config.use_iframe=p.config.use_iframe,f.isEmpty(b)||f.extend(a._config,b);var c=p.getModule("event_manager"),d=a._context.ready_state,e=function(){var b=f.contains(d,"message_loaded")||p.config.msg,c=f.contains(d,"css_loaded");b&&c&&a.display()};c.clearaddEventListener("message_loaded",function(){d.push("message_loaded"),e()}),c.clearaddEventListener("css_loaded",function(){d.push("css_loaded"),e()}),a._modules.api=p.getModule("server_api")},a._dom={container:null},a._isExistContainer=function(){var b=p.getModule("container_manager").getContainer();return b&&a._dom.container},a._createContainer=function(){var b,c;return(b=p.getModule("container_manager").getContainer())?(c=q("<div>"),c.addClass("greepf-footer-container"),b.append(c),a._dom.container=q(".greepf-footer-container"),!0):!1},a._config.container_html_open=String()+"<div class='_gpf-contWrap'><div class='_gpf-contr'>",a._config.container_html_close=String()+"</div></div>",a._config.container_unit_html_open=String()+"<div class='_gpf-unit'>",a._config.container_unit_html_close=String()+"</div>",a._config.container_menu_html=String()+"<div class='_gpf-cst _gpf-hasSpaceFat' id='{id_name}'><div class='_gpf-flex' {link}><div class='_gpf-itm'><div class='_gpf-lead'>{container_msg}</div></div><div class='_gpf-itmCaret'><span class='_gpf-spr _gpf-ia18_arw_r'></span></div></div></div>",a._config.vg1_upgrade_html=String()+"<div class='_gpf-emgCst _gpf-hasSpace'><div class='_gpf-flex' {link} id='vg1-upgrade-link'><div class='_gpf-wrapIco18'><span class='_gpf-spr _gpf-s18_etc_alert'></span></div><div class='_gpf-itm _gpf-vaM'><div>{$footer.guest_play}<span class='_gpf-fsT'> {remaining_lifetime}</span></div></div><div class='_gpf-itm _gpf-vaM _gpf-taR'><div class='_gpf-minorS _gpf-fsT _gpf-fwN'>{$footer.upgrade_link}</div></div><div class='_gpf-itmCaret'><span class='_gpf-spr _gpf-ia18_arw_r'></span></div></div></div>",
a._config.container_for_grade2_user_html_open=String()+"<div class='_gpf-cst _gpf-hfCst'><div class='_gpf-hfCstIn'>",a._config.container_for_grade2_user_html_close=String()+"</div></div>",a._config.container_for_grade2_user_html=String()+"<div class='_gpf-hfCol _gpf-hasSpaceFat' id='{id_name}'><div class='_gpf-flex' {link}><div class='_gpf-wrapIco18'><span class='_gpf-spr _gpf-pymt_{half_css}'></span></div><div class='_gpf-itm _gpf-vaM'><div class='_gpf-lead'>{half_msg}</div></div><div class='_gpf-itmCaret'><span class='_gpf-spr _gpf-ia18_arw_r'></span></div></div></div>",a._config.misc_html=String()+"<div class='_gpf-unit _gpf-taC _gpf-space15' id='gpf-misc'><a class='_gpf-lnk _gpf-spaceR10' {link_settings} id='gpf-misc-settings'>{$footer.link_settings}</a><a class='_gpf-lnk _gpf-spaceR10' {link_help} id='gpf-misc-help'>{$footer.link_help}</a><a class='_gpf-lnk' {link_contact} id='gpf-misc-contact'>{$footer.link_contact}</a></div>",a._config.banner_html_open=String()+"<div class='_gpf-unit _gpf-space15'><div class='_gpf-flex' id='gpf-banner'>",a._config.banner_html_close=String()+"</div></div>",a._config.banner_html=String()+"<div class='_gpf-wrapIco48 _gpf-taC'><div class='_gpf-ico48 _gpf-app {tag_css}' style='background-image:url({img_url})'><a class='_gpf-ico48' {link}>{tag}</a></div></div>",a._config.announce_html=String()+"<div class='_gpf-unit _gpf-taC'><a class='_gpf-lnk' {link}>{announce_msg}</a></div>",a._config.copyright_html=String()+"<div class='_gpf-unit _gpf-taC'><div class='_gpf-unit _gpf-taC'><div class='_gpf-minor'>{$footer.copyright_msg}</div></div></div>",a._config.tabfooter_html_open=String()+"<div class='_gpf-navFootWrap _gpf-static'><div class='_gpf-navFoot'><div class='_gpf-contr'><div class='_gpf-flex'>",a._config.tabfooter_html_close=String()+"</div></div></div></div>",a._config.tabfooter_item_html=String()+"<div class='_gpf-itm' id='{id_name}'><a class='_gpf-in' href='{link}'><div class='_gpf-in'><span class='_gpf-spr _gpf-ia24_gnav_{item_css}'></span><div class='_gpf-txt'>{item_name}</div></div></a></div>",a._config.boost_html=String()+"<div class='_gpf-itm' id='{id_name}'><a class='_gpf-in' href='{link}'><div class='_gpf-in'><div class='_gpf-ico33 _gpf-tap' style='background-image:url({img_url})'></div>{tag_class}</div></a></div>",a.displayHandler=f.createExecuteOnceHandler(function(){if(!a._config.enabled)return!1;if(!a._isExistContainer()&&!a._createContainer())return!1;a.Extend&&a.Extend.ModStyle&&a.Extend.ModStyle.resetStyle();var b,c=!0,d=432e5;return a._modules.api.process("get_footer_data",{app_id:a._config.app_id,use_iframe:a._config.use_iframe,append_footer:a._const.ALL_INFO},function(c){f.isEmpty(c.data)||(a._context.is_webview_app=c.data.is_webview_app,a._context.domains=c.data.domains,b=q("<div>"),b.addClass(a._config.basic_class),b.addClass("_gpf-staticNavFoot"),a.appendContainerHtml(b,c.data),a.appendBottomHtml(b,c.data),a._dom.container.html(f.util.replaceMessage(b.firstChild.outerHTML)),a.bindClearCache("#vg1-upgrade-link"))},c,d),a.displayHandler.reset(),!0}),a.bindClearCache=function(b){link=q(b),link.bindEvent("click",function(){a._modules.api.clearCache(),this.click()},!1)},a.display=a.displayHandler.execute,a.appendContainerHtml=function(b,c){container_html=a._config.container_html_open,container_html+=a.getVg1UpgradeHtml(c),container_html+=a.getContainerWrapperHtml(c),container_html+=a.getMiscHtml(c),container_html+=a.getBannerHtml(c),container_html+=a.getAnnounceHtml(c),container_html+=a._config.container_html_close,b.html(container_html)},a.getVg1UpgradeHtml=function(b){if(!b.can_show_vg1_upgrade_link||!b.remaining_lifetime_hour)return"";var c=[],d=a._config.app_id;return c.push(a._config.vg1_upgrade_html.replace(a._config.regex.convert_item,function(c){if("{link}"==c){var e;return e=a.isSandbox()?a.getUnsupportedUrl():a._context.domains.https_root_id+"upg/entry?from_ggpfooter=upgrade_"+d+"&app_id="+d,e=a._appendBackTo(e),"onclick='location.href=\""+e+"\"'"}return"{remaining_lifetime}"==c?b.remaining_lifetime_hour?"{$footer.remaining_lifetime_open}"+b.remaining_lifetime_hour+"{$footer.remaining_lifetime_close}":"":void 0})),a._config.container_unit_html_open+c.join("")+a._config.container_unit_html_close},a.getContainerWrapperHtml=function(b){if(b.is_webview_app&&b.none_show_around_footer_link)return"";var c=[],d=a._config.app_id;if(b.none_show_coin_link||"none"==b.coin_msg||c.push(a._config.container_menu_html.replace(a._config.regex.convert_item,function(c){if("{container_msg}"==c)return b.coin_msg?b.coin_msg:"{$footer.gree_coin_msg}";if("{id_name}"==c)return"gpf-coin";if("{link}"==c){var e;return e=a.isSandbox()?a.getUnsupportedUrl():a._context.domains.http_root_tpay+"?from_ggpfooter=coin_"+d,a._context.is_webview_app?'onclick=\'GREE.ui({method:"deposit-product", view:"popup"});\'':(e=a._appendBackTo(e),"onclick='location.href=\""+e+"\"'")}})),!b.none_show_invite_link)if(b.can_show_upgrade_lp){var e=[],f=[{css:"friend",msg:"{$footer.half_invite_msg}",link:'onclick=\'GREE.ui({method:"invite", view:"invite_dialog"})\'',idn:"gpf-invite"},{css:"coin",msg:"{$footer.half_update_msg}",link:"onclick='location.href=\""+a._context.domains.http_root_campaign+"?action=special_upgrade&app_id="+d+"&from_ggpfooter=upgrade_lp&ref_key=ggpfooter\"'",idn:"gpf-update"}];a.isSandbox()&&(f[1].link="onclick='location.href=\""+a.getUnsupportedUrl()+"\"'"),f.forEach(function(b){e.push(a._config.container_for_grade2_user_html.replace(a._config.regex.convert_item,function(a){return"{half_css}"==a?b.css:"{half_msg}"==a?b.msg:"{id_name}"==a?b.idn:"{link}"==a?b.link:void 0}))}),c.push(a._config.container_for_grade2_user_html_open+e.join("")+a._config.container_for_grade2_user_html_close)}else c.push(a._config.container_menu_html.replace(a._config.regex.convert_item,function(a){return"{container_msg}"==a?"{$footer.invite_msg}":"{id_name}"==a?"gpf-invite":"{link}"==a?'onclick=\'GREE.ui({method:"invite", view:"invite_dialog"})\'':void 0}));return a._config.container_unit_html_open+c.join("")+a._config.container_unit_html_close},a.getMiscHtml=function(b){var c,d,e,g="",h=a._config.app_id;if(a.isSandbox()){var i=a.getUnsupportedUrl();c=d=e=a.makeLinkFromUrl(i)}else c=a.makeLinkFromUrl(a._context.domains.http_root_apps+"gd/app/info/setting/view/"+h,!0),d=a.makeLinkFromUrl(a._context.domains.http_root_apps+"gd/app/info/"+h,!0),e=f.isEmpty(b.right_now_category)?a.makeLinkFromUrl(a._context.domains.http_root_help+"?action=app_form&app_id="+h,!0):a.makeLinkFromUrl(a._context.domains.http_root_help+"?action=form&rnt_type="+b.right_now_category+"&app_id="+h,!0);return g=a._config.misc_html.replace(a._config.regex.convert_item,function(a){return"{link_settings}"==a?c:"{link_help}"==a?d:"{link_contact}"==a?e:void 0})},a.getBannerHtml=function(b){var c="",d=[];return f.isEmpty(b.banner_infos)||(selected_banner_infos=a._selectBannerInfos(b.banner_infos),d=a._getBannerItemHtml(selected_banner_infos),c=a._config.banner_html_open+d.join("")+a._config.banner_html_close),c},a._selectBannerInfos=function(b){var c=[],d=[];b.forEach(function(a){f.isEmpty(a.tag_name)?c.push(a):d.push(a)});var e=d.length;if(e>=a._const.BANNER_CHUNK_SIZE)return a._shuffle(d,a._const.BANNER_CHUNK_SIZE);var g=a._const.BANNER_CHUNK_SIZE-e,h=a._shuffle(c,g);return h=h.concat(d),a._shuffle(h)},a._getBannerItemHtml=function(b){var c,d=[],e=a._getBannerQuery();return b.forEach(function(b){d.push(a._config.banner_html.replace(a._config.regex.convert_item,function(d){if("{img_url}"==d)return b.image_url;if("{link}"==d)return c=a.isSandbox()?a.getUnsupportedUrl():a._context.domains.http_root_apps+b.app_id+"?"+e,a.makeLinkFromUrl(c);if("{tag_css}"==d)return f.isUndefined(b.tag_name)?"":"_gpf-icoTag";if("{tag}"==d){var g=b.tag_name;return f.isUndefined(g)?"":"<span class='_gpf-icoTag"+g.charAt(0).toUpperCase()+g.slice(1)+"'></span>"}}))}),d},a._getBannerQuery=function(){return a._context.is_webview_app?a._config.banner_query.webview.replace("{app_id}",a._config.app_id):a._config.banner_query.spweb.replace("{app_id}",a._config.app_id)},a.getAnnounceHtml=function(b){if(a._context.is_webview_app)return"";var c="",d=[];return f.isEmpty(b.campaign_announces)||(b.campaign_announces.forEach(function(b){d.push(a._config.announce_html.replace(a._config.regex.convert_item,function(c){return"{announce_msg}"==c?b.title:"{link}"==c?a.makeLinkFromUrl(b.link_url):void 0}))}),c=d.join("")),c},a.appendBottomHtml=function(b,c){var d="";if(c.is_tab_footer_user){var e,g,h,i,j=[],k=a._context.domains.http_root_games,l="from_ggpfooter=tab_",m="_"+a._config.app_id+(a._config.use_iframe?"":"_noiframe");if(a.isSandbox()){var n=a._context.domains.http_root_gree_net,o=a.getUnsupportedUrl();h={top:n,mygame:n,search:o,chat:o,recommend:o}}else h={top:k,mygame:k+"?action=myapp_list",search:k+"search/",chat:a._context.domains.http_root_apps+"?action=app_chat_view#view=game_list",recommend:k+"recommend/list"};a._config.tabfooter.forEach(function(b){if(i=b.key,"chat"!=i||c.is_chat_app){if("recommend"==i&&!f.isEmpty(c.boost_announces))return boost_html=a._config.boost_html,boost_announce=c.boost_announces[0],void j.push(boost_html.replace(a._config.regex.convert_item,function(a){return"{link}"==a?boost_announce.link_url:"{id_name}"==a?"gpf-tab-"+i:"{tag_class}"==a?boost_announce.is_hot?"<span class='_gpf-ntfBadge _gpf-skOrange _gpf-fsT _gpf-last'>HOT</span>":boost_announce.is_cm?"<span class='_gpf-ntfBadge _gpf-skBlue _gpf-fsT _gpf-last'>CM中</span>":"":"{img_url}"==a?boost_announce.image_url:void 0}));e=a._config.tabfooter_item_html,j.push(e.replace(a._config.regex.convert_item,function(a){if("{link}"==a){g="chat"!=i?l+b.gm+m:"";var c=h[i];return c+f.getUrlSeparator(c)+g}return"{item_css}"==a?b.css:"{id_name}"==a?"gpf-tab-"+i:"{item_name}"==a?"{$footer.tabfooter_"+i+"}":void 0}))}}),d=a._config.tabfooter_html_open+j.join("")+a._config.tabfooter_html_close}else d=a._config.copyright_html;parent_origin_html=b.html(),b.html(parent_origin_html+d)},a.makeLinkFromUrl=function(b,c){return a._context.is_webview_app?'onclick=\'GREE.ui({method:"open", view:"dashboard",url:"'+b+"\"})'":(c&&(b=a._appendBackTo(b)),"href='"+b+"'")},a._appendBackTo=function(a){var b=encodeURIComponent(p.getGreeAppTopUrl()+"?url="+encodeURIComponent(location.href)),c=f.getUrlSeparator(a);return a+c+"backto="+b},a.getAnalytics=function(){return""},a.isDisplayed=function(){var b="."+a._config.basic_class;return q(b).isNotEmpty()},a.isSandbox=function(){var a=["pf-sbstg1.gree.net","pf-sb.gree.net"];return f.contains(a,p.config.domain)},a.getUnsupportedUrl=function(){return a._context.domains.http_root_gree_net+"?action=unsupported_sandbox"},a._shuffle=function(b,c){var d,e=0,f=[];return b.forEach(function(b){d=a._random(e++),f[e-1]=f[d],f[d]=b}),c?f.slice(0,c):f},a._random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},p.addModule("footer_lite",a)}(),function(){var a=p.getModule("footer_lite"),b={};b.config={style_class_map:{container:"._gpf-glContr",coin_box:"#gpf-coin",invite_box:"#gpf-invite",menu_link:"a._gpf-lnk"}},b.resetStyle=function(){if(a._config.style){var c=q("<style>");c.setAttribute("type","text/css");var d="";Object.keys(b.config.style_class_map).forEach(function(c){a._config.style[c]&&(d+=b.config.style_class_map[c]+a._config.style[c]+" ")}),c.html(d),p.getModule("container_manager").getContainer().append(c)}},a.Extend=a.Extend||{},a.Extend.ModStyle=b}(),function(){var a={};a._config={app_id:null,app_url:null,pf_url:null,upgrade_action:null,service_code:null,default_backto:null},a.init=function(b){a._config.app_id=p.config.app_id,a._config.upgrade_action="confirm_upgrade",a._config.service_code="DR"},a.show=function(b){var c=p.config.context.http_root_id,d={action:a._config.upgrade_action,target_grade:b.target_grade,service_code:a._config.service_code,app_id:a._config.app_id,backto:b.callback_url||f.util.createOauthCallbackUrl()},e=p.getModule("gree_id_upgrade");e?(f.extend(d,{url:c,is_modal:1,contentsAreaId:p.config.game_container_id}),e.init(d),e.show()):f.setLocationHref(f.appendUrlParmas(c,d))},p.addModule("upgrade",a)}(),function(){var a={};a._config={command_js_url:"http://aimg-static.gree.net/ggp/js/command.min.js",script_tag_id:"greepf-webview-js"},a._dom={script_tag_el:null},a._modules={container_manager:null},a.init=function(b){a._modules.container_manager=p.getModule("container_manager")},a._createScriptTag=function(){var b=document.createElement("script");return b.src=a._config.command_js_url,b.onload=function(){proton.app.init(),p.dispatchEvent("webview_js_imported")},b},a.isWebview=function(){return p.config.is_webview===!0},a.isEnabledCommand=function(b){return a.isWebview()&&proton&&proton.app&&f.isFunction(proton.app[b])},a.executeCommand=function(b,c,d){return a.isEnabledCommand(b)?(f.debug(function(){return{type:"[important]",command:"proton.app["+b+"]",params:c?c:""}}),proton.app[b](c,d),!0):!1},a.enabledShowWebViewDialog=function(){if(!a.isWebview())return!1;var b=p.config.sdk;return b?!("android"===b.device&&-1===a.versionCompare(b.version,"3.2.0")):!1},a.versionCompare=function(a,b){var c=function(a){if(!f.isString(a))return null;var b=a.split(".");return 3!==b.length?null:{maj:0|b[0],min:0|b[1],bld:0|b[2]}},d=function(a,b){return a>b?1:b>a?-1:a==b?0:null},e=c(a),g=c(b);for(var h in e){var i=d(e[h],g[h]);if(null===i)return null;if(0!==i)return i}return 0},a.importScript=function(){a.isWebview()&&(a._dom.script_tag||(a._dom.script_tag=a._createScriptTag(),q("head").append(a._dom.script_tag)))},p.addModule("webview",a)}(),function(){var a={};a._modules={},a.init=function(){},a.showDashboard=function(a){a.URL&&f.setLocationHref(a.URL)},a.requestLocation=function(a){a.url&&f.util.requestLocation(a.url)},a.launchNativeApp=function(a){f.util.launchNativeApp(a)},a.logout=function(){f.warn("unsupported!")},a.xapp=function(b,c){function d(){var b=f.appendUrlParmas(p.config.context.http_root_gree_net,{action:"redirect_xapp",campaign_id:g,from_xapp:g+"_participate"}),d={URL:b};i&&i.executeCommand("showDashboard",d,c)||a.showDashboard(d)}function e(a){var b=a.launch_url,d=a.store_url,e=a.optional_path,g=a.package_name,h=a.url_scheme;return f.util.isWebview()?i.executeCommand("launchNativeApp",{URL:b,ios_src:d,android_src:d},c):(f.util.isUsableAndroidIntent()?f.util.launchExternalAppByAndroidIntent(e,g,h):f.util.launchExternalApp(b,function(){return f.isUndefined(d)?void f.error("[GREE.ui] cannot install application"):void f.setLocationHref(d)}),void f.util.launchedExternalApp.launched())}var g=b.campaign_id,h=p.config.app_id,i=p.getModule("webview"),j=p.getModule("server_api");j.process("xapp",{app_id:h,campaign_id:g},function(a){return 1!=a.result?void f.error("[GREE.ui] unknown api error"):1!=a.is_launch_app?d():void e(a)})},a.launchMailer=function(a){a.subject=!f.isUndefined(a.subject)&&a.subject?a.subject:"",a.body=!f.isUndefined(a.body)&&a.body?a.body:"";var b=a.subject.replace(/&amp;+/g,"%26"),c=a.body.replace(/[\r\n]/g,"%0D%0A");c=c.replace(/&amp;+/g,"%26"),f.setLocationHref("mailto:?subject="+b+"&body="+c),p.dispatchEvent("mailer_launched",{result:"success"})},p.addModule("open",a)}(),function(){var a=function(){this._config={app_id:null,tags:[]},this._modules={client_ui:null,client_api:null},this._submodules={},this._temp={}};a.prototype.addSubModule=function(a,b){this._submodules[a]=b},a.prototype.getParams=function(a,b){var c,d,e={};return c=a.substring(b.length+1).split("&"),f.loop(c,function(a){d=a.split("="),e[d[0]]=d.slice(1).join("=")}),e},a.prototype.getTargetAttributes=function(a){var b=null;return"A"===a?b=["href"]:"IMG"===a&&(b=["data-gree-src","src","gree-src"]),b},a.prototype.getAttributeValue=function(a){var b=a.tagName.toUpperCase(),c=this.getTargetAttributes(b),d=null;if(c)for(var e in c)if(a.hasAttribute(c[e])){d=a.getAttribute(c[e]);break}return d},a.prototype.search=function(a,b){var c,d=[],e=this;if(e._temp.hasOwnProperty(a)?c=e._temp[a]:(c=q(a),e._temp[a]=c),c.isNotEmpty()){var g;c.each(function(a){a=a.firstChild,g=e.getAttributeValue(a),g&&f.startsWith(g,b)&&d.push({el:a,params:e.getParams(g,b)})})}return d},a.prototype.init=function(a){if(a){var b=this;b._config.app_id=p.config.app_id,b._config.tags=a.tags,b._modules.client_ui=p.getModule("client_ui"),b._modules.client_api=p.getModule("client_api"),Object.keys(b._submodules).forEach(function(a){b._submodules[a].init()})}},a.prototype.searchTag=function(){var a=this,b=!1;return a._config.tags.forEach(function(c){c.search_result=a.search(c.tag,c.identifier),f.isEmpty(c.search_result)||(b=!0)}),b},a.prototype.execute=function(){var a=this;a._config.tags.forEach(function(b){f.isEmpty(b.search_result)||("a"==b.tag?a.addEvent(b.method,b.search_result,b.append_params):"img"==b.tag&&a._submodules[b.identifier]&&a._submodules[b.identifier].execute(b.search_result))})},a.callback={},a.prototype.addEvent=function(b,c,d){var e=this;c.forEach(function(c){c.el.setAttribute("href","javascript:void(0);"),c.el.addEventListener("click",function(){var g=f.copy(c.params),h=a.callback[g.callbackfunc];g.callbackurl&&(g.callback_url=g.callbackurl),d&&f.extend(g,d);for(var i in g)g[i]=decodeURIComponent(g[i]);g.old_tag=!0,0===b.indexOf("/")?e._modules.client_api.process(b,g,h):e._modules.client_ui.process(b,g,h)})})},a.ResponseItem=function(a){var b=a.status;this.originalDataRequest_=null,this.data_=a.data,this.errorCode_,this.errorMessage_,b&&200!=b.code&&(403==b.code?(this.errorCode_="forbidden",this.errorMessage_="Viewer does not use this application."):(this.errorCode_="internalError",this.errorMessage_=["Unknown Error: ",b.code]))},a.ResponseItem.prototype.hadError=function(){return!!this.errorCode_},a.ResponseItem.prototype.getErrorCode=function(){return this.errorCode_},a.ResponseItem.prototype.getErrorMessage=function(){return this.errorMessage_},a.ResponseItem.prototype.getOriginalDataRequest=function(){return originalDataRequest_},a.ResponseItem.prototype.getData=function(){return this.data_},window.greepf={callbackStore:{register:function(b,c){a.callback[b]=function(b){if(b.data&&"share"==b.data.service)"callbackurl"in b.data&&delete b.data.callbackurl;else if(b.data&&b.data.callbackurl)return void p.getModule("client_ui").process("request_location",{url:b.data.callbackurl});b.data&&"invite"==b.data.service&&"recipient_user_ids"in b.data&&(b.data.recipientIds=b.data.recipient_user_ids,delete b.data.recipient_user_ids),c(new a.ResponseItem(b))}}},requestScrollTo:function(a,b){var c=p.getModule("game_container");c&&c.scrollTo(a,b)},event:{EventListenerList:function(){function a(){return{listeners:function(){return b},add:function(a,c){var d=b[a];d||(d=[],b[a]=d),d.push(c)},fire:function(a){var c=b[a.type];if(c)for(i in c)c[i].call(this,a)},remove:function(a,c){if(!c)return void delete b[a];var d=b[a];if(d)for(i in d)if(d[i]===c){d.splice(i,1);break}}}}var b={};return a()}()}},p.addModule("replace_tag",new a),p.addModule("replace_tag_ics",new a)}(),function(){var a=p.getModule("replace_tag"),b={};b._modules={api:null},b.init=function(a){b._modules.api=p.getModule("client_ui")},b.execute=function(a){var c=[];a.forEach(function(a){c.push([a.params.url])}),b._modules.api.process("request_image_proxy",{urls:c},function(c){b._replaceTag(c,a)})},b._replaceTag=function(a,b){var c,d;for(d in a)c=a[d],c&&b[d].el.setAttribute("src",c)},a.addSubModule("image:px",b)}(),function(){var a=p.getModule("replace_tag"),b={};b._config={app_id:null},b._modules={api:null},b.init=function(){b._config.app_id=p.config.app_id,b._modules.api=p.getModule("server_api")},b.execute=function(a){var c=[];a.forEach(function(a){a.params.user_id&&c.push([a.params.user_id,a.params.size])}),b._modules.api.process("get_thumbnail",{app_id:b._config.app_id,user_list:c},function(c){b._replaceTag(c.urls,a)})},b._replaceTag=function(a,b){if(a&&f.isArray(a)){var c={};a.forEach(function(a){c[a.user_id+"_"+a.size]=a.url}),b.forEach(function(a){a.el.setAttribute("src",c[a.params.user_id+"_"+a.params.size])})}},a.addSubModule("thumbnail:show",b)}(),function(){var a={};a._config={},a._modules={dialog:null},a._dom={},a._config.main_html=String()+"<div class='greepf-attention-content'></div>",a.init=function(){a._modules.dialog=p.getModule("dialog"),a._modules.event_manager=p.getModule("event_manager")},a._setDom=function(){a._dom.container=q("#greepf-attention-container"),a._dom.header_title=q("#greepf-attention-header-title"),a._dom.header_close=q("#greepf-attention-header-close"),a._dom.content=q(".greepf-attention-content"),a._dom_content_iframe=q("#greepf-attention-content-iframe")},a._openDialogHandler=f.createExecuteOnceHandler(function(b,c){f.util.prepareOpenDialog({prefix:"greepf-attention-",content_html:a._config.main_html,title:"",open_handler:a._openDialogHandler,parent_dialog_container:c.dialog_container,parent_close_func:c.close_func});var d=f.util.createEmptyIframe("greepf-attention-content-iframe");d.bindEvent("load",function(){f.util.adjustIframeHeight(d)}),q(".greepf-attention-content").append(d),a._setDom();var e=!0,g=3e5;p.getModule("server_api").process("get_attention_html",b,function(c){200===c.status.code?(a._dom.header_title.html(c.title),a._modules.dialog.show(),f.util.replaceIframeHtml(a._dom_content_iframe,c.html),setTimeout(f.util.scrollTop,500)):(f.error("params.page not found : ["+b.page+"]"),a._openDialogHandler.reset())},e,g)}),a.openDialog=a._openDialogHandler.execute,a.closeDialog=function(){a._modules.event_manager.dispatchEvent("greepf-attention-close-event")},p.addModule("attention",a)}(),function(){var a={};a._config={},a._modules={dialog:null},a._dom={},a._config.main_html=String()+"<div class='greepf-calendar-content'></div>",a.init=function(){a._modules.dialog=p.getModule("dialog"),a._modules.event_manager=p.getModule("event_manager");var b=p.getModule("rpc");b.addAllowTarget("simple_dialog"),b.register("close_calendar_dialog",a.closeDialog)},a._openDialogHandler=f.createExecuteOnceHandler(function(b,c){f.util.prepareOpenDialog({prefix:"greepf-calendar-",content_html:a._config.main_html,title:p.config.msg.calendar.header_title,open_handler:a._openDialogHandler,parent_dialog_container:c.dialog_container,parent_close_func:c.close_func});var d=f.util.createEmptyIframe("greepf-calendar-content-iframe");d.bindEvent("load",function(){f.util.adjustIframeHeight(d)}),q(".greepf-calendar-content").append(d),a._setDom(),a._dom_content_iframe.firstChild.src=b.url,a._modules.dialog.show()}),a.openDialog=a._openDialogHandler.execute,a._setDom=function(){a._dom.container=q("#greepf-calendar-container"),a._dom.header_title=q("#greepf-calendar-header-title"),a._dom.header_close=q("#greepf-calendar-header-close"),a._dom.content=q(".greepf-calendar-content"),a._dom_content_iframe=q("#greepf-calendar-content-iframe")},a.closeDialog=function(){Attention._modules.event_manager.dispatchEvent("greepf-calendar-close-event")},p.addModule("calendar",a)}(),function(){var a={};a._dom={script_tag_el:null},a._createScriptTag=function(){var a=document.createElement("script");return a.charset="UTF-8",a.src=p.getHttpAimgUrl("js/ggp/message.js"),a},a.importScript=function(){a._dom.script_tag_el||(a._dom.script_tag_el=a._createScriptTag(),q("head").append(a._dom.script_tag_el))},p.addModule("message_resource",a)}(),function(){var a={};a._config={app_id:null,context:null},a._modules={api:null,webview:null},a.init=function(){a._config.app_id=p.config.app_id,a._modules.api=p.getModule("server_api"),a._modules.webview=p.getModule("webview")},a.execute=function(b){var c={app_id:a._config.app_id,app_type:b.app_type,type:b.type,body:b.body,show_type:b.show_type,url:b.url};a._modules.api.process("get_external_service",c,function(d){if(1!=d.result)return void(d.reason?f.error("[GREE.ui] "+d.reason):f.error("[GREE.ui] unknown error. params:"+JSON.stringify(c)+", res:"+JSON.stringify(d)));var g=d.text,h=d.url,i=d.send_url,j=d.store_url,k=d.store_url_sp,l=d.url_scheme,m=d.package_name,n=d.optional_path,o=a._modules.webview,q=function(a){var c="ggp_service_external_redirect",d=p.config.context,e=f.appendUrlParmas(d.http_root_pf,{action:c,app_type:b.app_type,text:g,url:i}),h=a.result==l?e:j;o.executeCommand("launchNativeBrowser",{URL:h})};if(f.util.isWebview())if(e.ios()){var r={URL:h,ios_src:j};o.executeCommand("launchNativeApp",r)}else e.android()&&o.executeCommand("getAppList",{schemes:[l]},q);else f.util.isUsableAndroidIntent()?f.util.launchExternalAppByAndroidIntent(n,m,l):f.util.launchExternalApp(h,function(){return 0==k?void f.error("[GREE.ui] cannot install application"):void f.setLocationHref(k)}),f.util.launchedExternalApp.launched()})},p.addModule("service_external",a)}(),function(){var a={};a.config={delay_time:12e4,default_expire_timespan:21e5,url_patterns:[/(\?|&)e=([^&]+)/,/(\?|&)__gda__=([^_]+)/],cache_max:300},a.isExpired=function(b,c){return b-c>a.config.default_expire_timespan?!0:c>b},a.deleteExpired=function(){var b=k.get(j.APP.THUMBNAIL);if(!f.isEmpty(b)){var c=f.getTime();for(var d in b)Object.keys(b[d]).forEach(function(e){a.isExpired(b[d][e].expire,c)&&delete b[d][e]});Object.keys(b).forEach(function(a){0==Object.keys(b[a]).length&&delete b[a]}),k.set(j.APP.THUMBNAIL,b)}},a.deleteOverMaxSize=function(){var b=k.get(j.APP.THUMBNAIL);if(!f.isEmpty(b)){var c=Object.keys(b).length;if(c>a.config.cache_max){var d=a.config.cache_max-100;for(var e in b)if(c-=1,delete b[e],c==d)break;c!=d?k.remove(j.APP.THUMBNAIL):k.set(j.APP.THUMBNAIL,b)}}},a.getExpire=function(b,c,d){var e=c-d-a.config.delay_time,g=null;return f.loop(a.config.url_patterns,function(a){var c=b.match(a);return c&&c.length>2?(g=c[2],!1):void 0}),g=g?1e3*g+e:c+a.config.default_expire_timespan},a.allsize={},a.allsize.set=function(b){var c=k.get(j.APP.THUMBNAIL)||{};if(b.data){var d=f.getTime();Object.keys(b.data).forEach(function(e){var f,g,h,i=b.data[e];c[e]={},Object.keys(i).forEach(function(j){f=i[j],h=d,b.header&&b.header.res_time&&(h=b.header.res_time),g=a.getExpire(f,d,h),c[e][j]={url:f,expire:g}})}),k.set(j.APP.THUMBNAIL,c),a.deleteOverMaxSize()}},a.allsize.get=function(b){a.deleteExpired();var c=k.get(j.APP.THUMBNAIL);if(!c)return{};var d={};return b.forEach(function(a){c[a]&&c[a].small&&c[a].normal&&c[a].large&&c[a].huge&&(d[a]={},Object.keys(c[a]).forEach(function(b){d[a][b]=c[a][b].url}))}),d},a.allsize.util={},a.allsize.util.getNotCacheUserList=function(a,b){if(f.isEmpty(a))return b;var c=[];return b.forEach(function(b){a[b]||c.push(b)}),c},a.allsize.util.mergeResponse=function(a,b){return f.extend(b.data,a),b},a.allsize.util.formatResponse=function(a){return{data:a}},a.specific_size={},a.specific_size.set=function(b){var c=k.get(j.APP.THUMBNAIL)||{};if(b.urls){var d,e,g=f.getTime();b.urls.forEach(function(f){e=g,b.header&&b.header.res_time&&(e=b.header.res_time),d=a.getExpire(f.url,g,e),c[f.user_id]=c[f.user_id]||{},c[f.user_id][f.size]={url:f.url,expire:d}}),k.set(j.APP.THUMBNAIL,c),a.deleteOverMaxSize()}},a.specific_size.get=function(b){a.deleteExpired();var c=[],d=k.get(j.APP.THUMBNAIL);return f.isEmpty(d)?c:(b.forEach(function(a){var b=a[0],e=a[1];d[b]&&d[b][e]&&c.push({user_id:b,size:e,url:d[b][e].url})}),c)},a.specific_size.util={},a.specific_size.util.getNotCacheUserList=function(a,b){if(f.isEmpty(a))return b;var c,d,e=k.get(j.APP.THUMBNAIL),g=[];return b.forEach(function(a){c=a[0],d=a[1],e[c]&&e[c][d]||g.push(a)}),g},a.specific_size.util.mergeResponse=function(a,b){return b&&b.urls&&(b.urls=b.urls.concat(a)),b},a.specific_size.util.formatResponse=function(a){return{urls:a}},p.addModule("thumbnail_cache",a)}(),function(){var a=window.GREE||{},b=f.createExecuteOnceHandler(function(a){var b=[],c="_"+a.app_id;l.setSuffix(c),k.setSuffix(c);var d=k.get(j.APP.CONFIG)||{};a.domain=a.domain||f.util.getHostName(a.rpc_host),a.sandbox&&!a.domain&&(a.domain="pf-sb.gree.net"),p.setAppConfig({app_type:p.constant.app_type.SMARTPHONE,domain:a.domain,app_id:a.app_id,app_name:d.app_name,user_id:d.user_id,user_name:d.user_name,app_container_id:a.container_id,page_load_type:a.page_load_type,start_type:a.start_type,session_utime:d.session_utime,friends_count:d.friends_count,enable_footer:a.enableFooter,use_iframe:0,app_top_url:a.app_top_url,js_hostname:a.js_hostname,online_notification:a.online_notification,css_dynamically_load:a.css_dynamically_load}),p.config.enable_footer=p.config.enable_footer&&k.isAvailable(),p.getModule("online_notice")||p.addModule("online_notice",{}),p.setMoudleConfig({container_manager:{css_url:p.getHttpAimgUrl("css/gree_spa.css")},event_manager:{event_attach:{app_started:[p.getModule("container_manager").createContainer,function(){"hashchange"==p.config.page_load_type&&p.getModule("event_manager").attachEvent(q(window),"hashchange",function(){p.dispatchEvent("page_loaded")}),p.dispatchEvent("page_loaded"),p.dispatchEvent("load")},p.getModule("webview").importScript,p.getModule("message_resource").importScript],rpc_started:[p.updateStorageConfigData,p.getModule("webview").importScript],page_loaded:[function(){function a(){b=setInterval(function(){p.getModule("rpc").call("session_check",function(a){a.session_changed&&f.setLocationHref(p.getAppTopUrl())},{})},6e4)}greepf&&greepf.event&&greepf.event.EventListenerList&&greepf.event.EventListenerList.fire({type:"load"}),p.setCurrentAppPageUrl(document.location.href);var b;document.addEventListener("DOMFocusIn",function(a){clearInterval(b)},!1),document.addEventListener("DOMFocusOut",function(b){a()},!1),a()},p.getModule("analytics_log").add,p.getModule("heartbeat").run,p.getModule("online_notice").load],command_enabled:[function(){p.getModule("replace_tag").execute()}],heartbeat_executed:[p.getModule("footer_lite").display,p.getModule("app_state_check").execute,p.updateStorageConfigData],container_created:[p.getModule("rpc").start],friends_changed:[p.getModule("request").removeFriendsCache],unauthorized_error:[function(){f.setLocationHref(f.util.createOauthCallbackUrl())}]},afterEach:function(a){("app_started"===a||"webview_js_imported"===a)&&b.push(a),p.state.ready!=p.constant.ready_state.COMPLETE&&f.contains(b,"app_started")&&!f.isUndefined(p.config.context)&&!f.isUndefined(p.config.is_webview)&&(!p.config.is_webview||p.config.is_webview&&f.contains(b,"webview_js_imported"))&&(f.debug(function(){return"[important]command_enabled"}),p.changeReadyState(p.constant.ready_state.COMPLETE),p.dispatchEvent("command_enabled"),p.delay.execute())}},callback:{sign:"2legged"},replace_tag:{tags:[{tag:"img",identifier:"thumbnail:show"},{tag:"img",identifier:"image:px"},{tag:"a",identifier:"invite:friends",method:"invite"},{tag:"a",identifier:"request:friends",method:"request"},{tag:"a",identifier:"mood:send",method:"share"}]},heartbeat:{append_list:[p.getModule("online_notice").getAnalytics,p.getModule("footer_lite").getAnalytics]},footer_lite:{style:a.footer?a.footer.style:null}}),p.start()});a.init=b.execute,a.loadedPage=function(){p.config.page_load_type==p.constant.page_load_type.MANUAL&&p.dispatchEvent("page_loaded")},a.start=function(a){a.start_type="immediately",b.reset(),b.execute(a)},a.ui=p.delay.command(function(a,b){var c=p.getModule("client_ui");c.process(a.method,a,b)}),a.wa={},a.wa.ui=function(b,c){a.ui(b,c)},a.api=p.delay.command(function(a,b,c){var d=p.getModule("client_api");d.process(a,b,c)}),a.extend={},a.extend.config=function(a){p.setAppConfig(a)},a.events=function(){function a(){return{listen:function(a,c){b.removeaddEventListener(a.name,a.listener)},unlisten:function(a,c){b.removeEventListener(a.name,a.listener)},fire:function(a){p.dispatchEvent(a.name)}}}var b=p.getModule("event_manager");return a()}(),window.GREE=a}()}();